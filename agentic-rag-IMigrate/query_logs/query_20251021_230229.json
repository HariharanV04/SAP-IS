{
  "timestamp": "20251021_230229",
  "job_id": null,
  "iflow_name": "IFlow_ca9dfa1e",
  "original_markdown": "# Create Salesforce Opportunities from Stripe Subscriptions Integration\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration creates a seamless data pipeline between Stripe payment platform and Salesforce CRM system. The primary business purpose is to automatically generate Salesforce Opportunity records when Stripe subscription events are completed, ensuring sales teams have immediate visibility into new revenue opportunities.\r\n\r\n**Base URL Pattern:**\r\n- Stripe Webhook Endpoint: Configured webhook listener for subscription events\r\n- Salesforce API: Standard Salesforce REST API for opportunity creation\r\n\r\n**Authentication Mechanisms:**\r\n- Stripe: Webhook signature validation\r\n- Salesforce: OAuth 2.0 or username/password authentication\r\n\r\n**Response Format:** \r\n- Input: JSON webhook payload from Stripe\r\n- Output: XML Salesforce opportunity creation response\r\n\r\n## Endpoints\r\n\r\n### Stripe Webhook Listener\r\n- **HTTP Method:** POST\r\n- **Purpose:** Receives subscription completed events from Stripe\r\n- **Request Parameters:** \r\n  - Headers: Stripe-Signature for webhook validation\r\n  - Body: JSON payload containing subscription details\r\n- **Request Body Structure:** \r\n  - Subscription object with customer information\r\n  - Payment details and subscription metadata\r\n  - Timestamp and event type information\r\n- **Response Format:** HTTP 200 OK acknowledgment\r\n- **Error Handling:** Returns appropriate HTTP status codes for webhook validation failures\r\n\r\n### Salesforce Opportunity Creation\r\n- **HTTP Method:** POST\r\n- **Purpose:** Creates new Opportunity records in Salesforce\r\n- **Request Parameters:**\r\n  - Authorization header with valid Salesforce session token\r\n  - Content-Type: application/xml\r\n- **Request Body Structure:** XML opportunity object with required fields\r\n- **Response Format:** Salesforce API response with created opportunity ID\r\n- **Error Handling:** Salesforce fault responses for validation failures\r\n\r\n## Current Boomi Flow Logic\r\n\r\n### Process Flow Overview\r\n\r\nThis Boomi integration process is triggered by Stripe subscription completion events and creates corresponding Salesforce opportunities through the following sequence:\r\n\r\n1. **Webhook Reception**: Listens for incoming Stripe subscription events\r\n2. **Dynamic Property Calculation**: Extracts and processes customer information, subscription details, and calculates opportunity attributes\r\n3. **Data Transformation**: Converts JSON webhook payload to Salesforce-compatible XML format\r\n4. **Opportunity Creation**: Sends transformed data to Salesforce to create new opportunity records\r\n\r\nThe process handles real-time data synchronization between payment processing and CRM systems, ensuring immediate sales visibility for new subscriptions.\r\n\r\n### Step-by-Step Flow Description\r\n\r\n---\r\n\r\n#### **Step 1: Start Event (shape1)**\r\n\r\n**Component Type:** Start Event\r\n\r\n**Purpose:** Initiates the integration process when Stripe webhook events are received\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Web Services Server (WSS)\r\n- **Operation:** Listen for incoming HTTP POST requests\r\n- **Input Profile:** JSON webhook payload from Stripe\r\n- **Trigger Conditions:** Stripe subscription completion events\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Raw JSON webhook payload containing subscription and customer data\r\n- **Processing:** Validates webhook signature and parses incoming request\r\n- **Output:** Parsed JSON document ready for property extraction\r\n\r\n---\r\n\r\n#### **Step 2: Document Properties (shape6)**\r\n\r\n**Component Type:** Document Properties\r\n\r\n**Purpose:** Extracts and calculates dynamic values from the incoming Stripe webhook payload for use in opportunity creation\r\n\r\n**Configuration Details:**\r\n\r\n- **Dynamic Properties:** 4 dynamic document properties are set:\r\n  - Dynamic Document Property - DDP_CustomerName: Process property: Dynamic Document Property - DDP_CustomerName\r\n  - Dynamic Document Property - DDP_Subscription: Process property: Dynamic Document Property - DDP_Subscription  \r\n  - Dynamic Document Property - DDP_SalesforceDescription: Process property: Dynamic Document Property - DDP_SalesforceDescription\r\n  - Additional property for close date calculation\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** JSON webhook payload from Stripe\r\n- **Processing:** Extracts customer name, subscription details, and calculates Salesforce opportunity description and close date\r\n- **Output:** Enhanced document with calculated dynamic properties available for downstream components\r\n\r\n---\r\n\r\n#### **Step 3: Transform/Map Component (shape4)**\r\n\r\n**Component Type:** Map/Transform\r\n\r\n**Purpose:** Converts the JSON webhook payload to XML format suitable for Salesforce opportunity creation\r\n\r\n**Configuration Details:**\r\n\r\n- **Input Profile:** Subscription Completed JSON structure\r\n- **Output Profile:** SF Opportunity CREATE Request XML\r\n- **Transformation Logic:** Maps webhook fields to Salesforce opportunity object\r\n- **Function Steps:** Utilizes DocumentPropertyGet functions to retrieve calculated values\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** JSON webhook data with calculated dynamic properties\r\n- **Processing:** Field-by-field transformation from JSON structure to Salesforce XML format\r\n- **Output:** Well-formed XML opportunity creation request\r\n\r\n---\r\n\r\n#### **Step 4: Connector Action (shape3)**\r\n\r\n**Component Type:** Salesforce Connector\r\n\r\n**Purpose:** Creates new opportunity records in Salesforce CRM system\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** salesforce\r\n- **Operation:** create\r\n- **Target Object:** Opportunity\r\n- **Authentication:** Salesforce OAuth or username/password authentication\r\n- **Error Handling:** Salesforce API fault handling for validation errors\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** XML opportunity creation request with all required fields\r\n- **Processing:** Submits create request to Salesforce API\r\n- **Output:** Salesforce response with created opportunity ID and success status\r\n\r\n---\r\n\r\n#### **Step 5: End Event (shape5)**\r\n\r\n**Component Type:** End Event\r\n\r\n**Purpose:** Completes the integration process successfully\r\n\r\n**Configuration Details:**\r\n\r\n- **Completion Type:** Successful process completion\r\n- **Final Actions:** Process completion logging\r\n- **Continuation Settings:** Process terminates after successful completion\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce creation response\r\n- **Processing:** Logs successful completion\r\n- **Output:** Process completion status indicating successful opportunity creation\r\n\r\n## Boomi Transformations Explained\r\n\r\n### Subscription Completed JSON to SF Opportunity CREATE Request XML\r\n\r\n**Purpose:** This transformation converts incoming Stripe subscription webhook data from JSON format into the XML structure required for Salesforce opportunity creation.\r\n\r\n**Input Profile:** Subscription Completed JSON\r\n- JSON webhook payload containing subscription details, customer information, and payment data from Stripe\r\n\r\n**Output Profile:** SF Opportunity CREATE Request XML  \r\n- XML structure conforming to Salesforce Opportunity object schema for create operations\r\n\r\n**Field Mappings:**\r\n\r\n| Source Field | Target Field | Data Type | Business Purpose |\r\n|--------------|--------------|-----------|------------------|\r\n| Dynamic Property (DDP_SalesforceDescription) | Opportunity/Description | String | Maps calculated description combining customer and subscription details |\r\n| Dynamic Property (DDP_CustomerName) | Opportunity/Name | String | Maps extracted customer name as opportunity name |\r\n| Dynamic Property (DDP_CloseDate) | Opportunity/CloseDate | Date | Maps calculated close date for opportunity timeline |\r\n\r\n**Transformation Functions Used:**\r\n\r\n1. **DocumentPropertyGet (ProcessProperty)**\r\n   - **Purpose:** Retrieves Dynamic Document Property - DDP_SalesforceDescription\r\n   - **Function:** Accesses the calculated Salesforce description property\r\n   - **Output:** Formatted description string for opportunity record\r\n\r\n2. **DocumentPropertyGet (ProcessProperty)**\r\n   - **Purpose:** Retrieves Dynamic Document Property - DDP_CustomerName  \r\n   - **Function:** Accesses the extracted customer name property\r\n   - **Output:** Customer name string for opportunity identification\r\n\r\n3. **DocumentPropertyGet (ProcessProperty)**\r\n   - **Purpose:** Retrieves Dynamic Document Property - DDP_CloseDate\r\n   - **Function:** Accesses the calculated close date property\r\n   - **Output:** Formatted date for opportunity close date field\r\n\r\n**Mapping Configuration Details:**\r\n- **3 → Opportunity/Description (profile):** Maps function output 3 to Description field\r\n- **3 → Opportunity/Name (profile):** Maps function output 3 to Name field  \r\n- **3 → Opportunity/CloseDate (profile):** Maps function output 3 to CloseDate field\r\n\r\nThe transformation leverages Boomi's dynamic property system to perform complex calculations and data extraction before mapping to the target Salesforce structure, ensuring rich opportunity records with contextual information derived from the subscription event.\r\n\r\n## SAP Integration Suite Implementation\r\n\r\n### Component Mapping\r\n\r\n#### Main Process Component Mapping\r\n| Boomi Component | SAP Integration Suite Equivalent | Purpose |\r\n|-----------------|----------------------------------|---------|\r\n| Start Event (shape1) | HTTPS Adapter (Sender) with Start Message Event | Receives incoming Stripe webhook requests via HTTPS |\r\n| Document Properties (shape6) | Content Modifier (Set Properties) | Extracts and calculates dynamic values from webhook payload |\r\n| Map/Transform (shape4) | Message Mapping | Converts JSON webhook data to Salesforce XML format |\r\n| Salesforce Connector (shape3) | HTTPS Adapter (Receiver) with Salesforce REST API | Creates opportunity records in Salesforce |\r\n| End Event (shape5) | End Message Event | Completes the integration flow successfully |\r\n\r\n### Integration Flow Visualization\r\n\r\n```mermaid\r\nflowchart TD\r\n    %% Define node styles for SAP Integration Suite components\r\n    classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px\r\n    classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px\r\n    classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px\r\n    classDef adapter fill:#FFD700,stroke:#333,stroke-width:2px\r\n    classDef event fill:#C0C0C0,stroke:#333,stroke-width:2px\r\n    classDef errorHandler fill:#FFA07A,stroke:#333,stroke-width:2px\r\n\r\n    %% Main Integration Flow\r\n    Start((\"Start Message Event\")):::event --> StripeWebhook[\"HTTPS Adapter: Stripe Webhook Receiver\"]:::httpAdapter\r\n    StripeWebhook --> SetDynamicProps[\"Content Modifier: Extract Dynamic Properties<br/>- Customer Name<br/>- Subscription Details<br/>- Description<br/>- Close Date\"]:::contentModifier\r\n    SetDynamicProps --> TransformData[\"Message Mapping: JSON to Salesforce XML<br/>Subscription → Opportunity\"]:::mapping\r\n    TransformData --> SalesforceCreate[\"HTTPS Adapter: Salesforce API<br/>Create Opportunity\"]:::adapter\r\n    SalesforceCreate --> End((\"End Message Event\")):::event\r\n\r\n    %% Dynamic Properties Detail\r\n    subgraph DynamicProperties[\"Dynamic Properties Calculation\"]\r\n        ExtractCustomer[\"Extract: Customer Name from Webhook\"]:::contentModifier\r\n        ExtractSubscription[\"Extract: Subscription Details\"]:::contentModifier\r\n        CalcDescription[\"Calculate: Salesforce Description\"]:::contentModifier\r\n        CalcCloseDate[\"Calculate: Opportunity Close Date\"]:::contentModifier\r\n    end\r\n\r\n    SetDynamicProps -.-> DynamicProperties\r\n```\r\n\r\n### Configuration Details\r\n\r\n#### HTTPS Adapter (Stripe Webhook Receiver)\r\n**Required Parameters:**\r\n- **Address:** `/stripe/webhook/subscription-completed`\r\n- **HTTP Method:** POST\r\n- **Authentication:** Webhook signature validation\r\n- **Content Type:** application/json\r\n- **Port:** 443 (HTTPS)\r\n\r\n#### Content Modifier (Dynamic Properties)\r\n**Required Parameters:**\r\n- **Property Name:** DDP_CustomerName\r\n- **Property Type:** Constant  \r\n- **Property Value:** `${in.body.customer.name}`\r\n- **Additional Properties:**\r\n  - DDP_Subscription: `${in.body.subscription.id}`\r\n  - DDP_SalesforceDescription: Concatenation of customer and subscription details\r\n  - DDP_CloseDate: Current date + 30 days calculation\r\n\r\n#### Message Mapping Configuration\r\n**Required Parameters:**\r\n- **Source Message Type:** Stripe_Subscription_JSON\r\n- **Target Message Type:** Salesforce_Opportunity_XML\r\n- **Mapping Program:** Custom XSLT or graphical mapping\r\n- **Function Libraries:** Date calculation and string manipulation functions\r\n\r\n#### HTTPS Adapter (Salesforce API)\r\n**Required Parameters:**\r\n- **URL:** `https://[instance].salesforce.com/services/data/v60.0/sobjects/Opportunity`\r\n- **HTTP Method:** POST\r\n- **Authentication:** OAuth 2.0 Bearer Token\r\n- **Content Type:** application/xml\r\n- **Headers:** \r\n  - Authorization: Bearer `${property.sf_access_token}`\r\n  - Accept: application/xml\r\n\r\n## Environment Configuration\r\n\r\n### Important Configuration Parameters\r\n- **Stripe Webhook Secret:** Required for webhook signature validation\r\n- **Salesforce Instance URL:** Target Salesforce org endpoint\r\n- **Salesforce API Version:** v60.0 or compatible version\r\n- **OAuth Client Credentials:** For Salesforce authentication\r\n\r\n### Environment Variables\r\n| Variable | Description | Example Value |\r\n|----------|-------------|---------------|\r\n| `STRIPE_WEBHOOK_SECRET` | Secret key for validating Stripe webhook signatures | `whsec_1234567890abcdef` |\r\n| `SF_CLIENT_ID` | Salesforce connected app client ID | `3MVG9...` |\r\n| `SF_CLIENT_SECRET` | Salesforce connected app client secret | `12345678901234567890` |\r\n| `SF_USERNAME` | Salesforce username for authentication | `integration@company.com` |\r\n| `SF_PASSWORD` | Salesforce password with security token | `password123TOKEN` |\r\n| `SF_INSTANCE_URL` | Salesforce instance URL | `https://companyname.my.salesforce.com` |\r\n\r\n### Dependencies on External Systems\r\n- **Stripe Platform:** Webhook configuration must point to integration endpoint\r\n- **Salesforce CRM:** Connected app configuration with API access permissions\r\n- **Network Connectivity:** HTTPS access to both Stripe and Salesforce APIs\r\n\r\n### Security Settings\r\n- **TLS/SSL:** All communications encrypted with TLS 1.2+\r\n- **Certificate Management:** Valid certificates for HTTPS endpoints\r\n- **Authentication:** OAuth 2.0 for Salesforce, webhook signature for Stripe\r\n- **IP Restrictions:** Configure IP allowlists if required\r\n\r\n### Deployment Considerations\r\n- **High Availability:** Deploy across multiple availability zones\r\n- **Scalability:** Configure auto-scaling for webhook processing\r\n- **Monitoring:** Implement comprehensive logging and alerting\r\n- **Error Handling:** Configure retry policies and dead letter queues\r\n\r\n### Required Resources\r\n- **Memory:** Minimum 512MB, recommended 1GB for message processing\r\n- **CPU:** 1-2 vCPU for standard throughput\r\n- **Storage:** 5GB for temporary message storage and logging\r\n- **Network:** Reliable internet connectivity with <2s latency to APIs\r\n\r\n## API Reference\r\n\r\n### Stripe Webhook API\r\n\r\n#### POST /stripe/webhook/subscription-completed\r\n**Description:** Receives Stripe subscription completion events\r\n\r\n**Headers:**\r\n| Header | Type | Required | Description |\r\n|--------|------|----------|-------------|\r\n| `Stripe-Signature` | String | Yes | Webhook signature for validation |\r\n| `Content-Type` | String | Yes | application/json |\r\n\r\n**Request Body Schema:**\r\n```json\r\n{\r\n  \"id\": \"evt_1234567890\",\r\n  \"object\": \"event\",\r\n  \"type\": \"customer.subscription.created\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"sub_1234567890\",\r\n      \"customer\": \"cus_1234567890\",\r\n      \"status\": \"active\",\r\n      \"current_period_start\": 1640995200,\r\n      \"current_period_end\": 1643673600\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Response Codes:**\r\n- `200 OK`: Webhook processed successfully\r\n- `400 Bad Request`: Invalid webhook signature\r\n- `500 Internal Server Error`: Processing error\r\n\r\n### Salesforce Opportunity API\r\n\r\n#### POST /services/data/v60.0/sobjects/Opportunity\r\n**Description:** Creates new opportunity records in Salesforce\r\n\r\n**Headers:**\r\n| Header | Type | Required | Description |\r\n|--------|------|----------|-------------|\r\n| `Authorization` | String | Yes | Bearer [access_token] |\r\n| `Content-Type` | String | Yes | application/xml |\r\n| `Accept` | String | Yes | application/xml |\r\n\r\n**Request Body Schema:**\r\n```xml\r\n<Opportunity>\r\n    <Name>Customer Subscription Opportunity</Name>\r\n    <Description>Opportunity created from Stripe subscription</Description>\r\n    <CloseDate>2024-12-31</CloseDate>\r\n    <StageName>Prospecting</StageName>\r\n    <Amount>1000.00</Amount>\r\n</Opportunity>\r\n```\r\n\r\n**Response Format:**\r\n```xml\r\n<OpportunityResponse>\r\n    <Id>006XXXXXXXXXXXXXXX</Id>\r\n    <Success>true</Success>\r\n</OpportunityResponse>\r\n```\r\n\r\n**Error Codes:**\r\n- `200 OK`: Opportunity created successfully\r\n- `400 Bad Request`: Invalid opportunity data\r\n- `401 Unauthorized`: Invalid or expired access token\r\n- `403 Forbidden`: Insufficient permissions\r\n\r\n### Authentication Requirements\r\n\r\n#### Stripe Webhook Validation\r\n- Verify webhook signature using Stripe webhook secret\r\n- Validate event timestamp to prevent replay attacks\r\n- Confirm event type matches expected subscription events\r\n\r\n#### Salesforce OAuth 2.0\r\n- Obtain access token using username/password or client credentials flow\r\n- Refresh tokens before expiration\r\n- Handle authentication errors and re-authenticate as needed\r\n\r\n### Rate Limiting Information\r\n\r\n#### Stripe Webhooks\r\n- No explicit rate limits for webhook delivery\r\n- Stripe implements automatic retry with exponential backoff\r\n- Recommend responding within 30 seconds\r\n\r\n#### Salesforce API\r\n- Daily API limits based on Salesforce edition\r\n- Per-hour rolling limits for bulk operations\r\n- Monitor API usage through Salesforce setup",
  "markdown_length": 18480,
  "constructed_query": "Create a complete SAP iFlow integration package named 'IFlow_ca9dfa1e' with the following requirements from the documentation:\n\n# Create Salesforce Opportunities from Stripe Subscriptions Integration\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration creates a seamless data pipeline between Stripe payment platform and Salesforce CRM system. The primary business purpose is to automatically generate Salesforce Opportunity records when Stripe subscription events are completed, ensuring sales teams have immediate visibility into new revenue opportunities.\r\n\r\n**Base URL Pattern:**\r\n- Stripe Webhook Endpoint: Configured webhook listener for subscription events\r\n- Salesforce API: Standard Salesforce REST API for opportunity creation\r\n\r\n**Authentication Mechanisms:**\r\n- Stripe: Webhook signature validation\r\n- Salesforce: OAuth 2.0 or username/password authentication\r\n\r\n**Response Format:** \r\n- Input: JSON webhook payload from Stripe\r\n- Output: XML Salesforce opportunity creation response\r\n\r\n## Endpoints\r\n\r\n### Stripe Webhook Listener\r\n- **HTTP Method:** POST\r\n- **Purpose:** Receives subscription completed events from Stripe\r\n- **Request Parameters:** \r\n  - Headers: Stripe-Signature for webhook validation\r\n  - Body: JSON payload containing subscription details\r\n- **Request Body Structure:** \r\n  - Subscription object with customer information\r\n  - Payment details and subscription metadata\r\n  - Timestamp and event type information\r\n- *\n\nGenerate a production-ready iFlow with proper:\n1. Start and End events\n2. Required adapters and connectors\n3. Content modifiers and processing steps\n4. Proper sequence flows\n5. Error handling\n6. SAP Integration Suite compliance\n",
  "query_length": 2358,
  "markdown_truncated_at": 2000,
  "api_endpoint": "/api/generate-iflow-from-markdown",
  "request_time": "2025-10-21T23:02:29.066501"
}