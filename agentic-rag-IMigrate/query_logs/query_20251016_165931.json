{
  "timestamp": "20251016_165931",
  "job_id": "8c05c9ac-a709-43a6-a03a-d23805bbc95c",
  "iflow_name": "BoomiFlow_fecd618d",
  "original_markdown": "# Stripe Subscription to Salesforce Opportunity Integration\n\n## Table of Contents\n\n1. [API Overview](#api-overview)\n2. [Endpoints](#endpoints)\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\n   - [Process Flow Overview](#process-flow-overview)\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\n   - [Component Mapping](#component-mapping)\n   - [Integration Flow Visualization](#integration-flow-visualization)\n   - [Configuration Details](#configuration-details)\n6. [Environment Configuration](#environment-configuration)\n7. [API Reference](#api-reference)\n\n## API Overview\n\nThis integration provides automated creation of Salesforce Opportunities from Stripe subscription events. The integration listens for Stripe webhook notifications when subscription events occur and automatically creates corresponding Opportunity records in Salesforce with appropriate field mappings and data enrichment.\n\n**Business Purpose:** Streamline the sales-to-billing process by automatically creating sales opportunities in Salesforce when customers subscribe to services through Stripe, ensuring data consistency between the payment platform and CRM system.\n\n**Base Integration Pattern:** Event-driven webhook listener with real-time data transformation and CRM synchronization\n\n**Authentication:** \n- Stripe: Webhook signature verification\n- Salesforce: OAuth 2.0 or session-based authentication\n\n**Data Flow Direction:** Stripe → Boomi → Salesforce (unidirectional)\n\n**Response Format:** JSON webhook payload from Stripe transformed to XML for Salesforce API\n\n## Endpoints\n\n### Stripe Webhook Listener Endpoint\n\n**HTTP Method:** POST  \n**Purpose:** Receive Stripe subscription webhook notifications  \n**Endpoint Pattern:** `/webhook/stripe/subscription`  \n\n**Request Headers:**\n- `Content-Type: application/json`\n- `Stripe-Signature: [webhook signature for verification]`\n\n**Request Body Structure:**\n```json\n{\n  \"type\": \"customer.subscription.created\",\n  \"data\": {\n    \"object\": {\n      \"id\": \"sub_xxxxxxxxx\",\n      \"customer\": \"cus_xxxxxxxxx\",\n      \"status\": \"active\",\n      \"current_period_start\": 1234567890,\n      \"current_period_end\": 1234567890,\n      \"plan\": {\n        \"id\": \"plan_xxxxxxxxx\",\n        \"name\": \"Premium Plan\"\n      }\n    }\n  }\n}\n```\n\n**Response Codes:**\n- `200 OK`: Webhook processed successfully\n- `400 Bad Request`: Invalid webhook payload\n- `401 Unauthorized`: Invalid webhook signature\n- `500 Internal Server Error`: Processing failure\n\n### Salesforce Opportunity Creation Endpoint\n\n**HTTP Method:** POST  \n**Purpose:** Create new Opportunity records in Salesforce  \n**Target Object:** Opportunity  \n**Operation:** create  \n\n**Request Body Structure (XML):**\n```xml\n<sObjects>\n  <Opportunity>\n    <Name>[Dynamic Customer Name]</Name>\n    <Description>[Dynamic Description]</Description>\n    <CloseDate>[Calculated Close Date]</CloseDate>\n    <StageName>Prospecting</StageName>\n  </Opportunity>\n</sObjects>\n```\n\n## Current Boomi Flow Logic\n\n### Process Flow Overview\n\nThis Boomi integration implements an event-driven pattern that processes Stripe subscription webhooks and creates corresponding Salesforce opportunities. The process includes dynamic property calculation, data transformation, and external system integration.\n\n**Process Triggers:** Stripe webhook events (subscription completed/created)  \n**Main Processing:** Dynamic property enhancement, JSON to XML transformation, Salesforce opportunity creation  \n**External Systems:** Stripe (webhook source), Salesforce (target CRM)  \n**Expected Outcome:** Automated opportunity creation with enriched customer and subscription data  \n\n### Step-by-Step Flow Description\n\n---\n\n#### **Step 1: Start Event (shape1)**\n\n**Component Type:** Start Event\n\n**Purpose:** Listen for incoming Stripe webhook notifications for subscription events\n\n**Configuration Details:**\n\n- **Connector Type:** HTTP Listener (implied from webhook pattern)\n- **Operation:** Listen for POST requests with JSON payloads\n- **Input Profile:** JSON webhook payload from Stripe\n- **Trigger Conditions:** Incoming HTTP POST requests from Stripe webhook\n\n**Data Flow:**\n\n- **Input:** Stripe subscription webhook JSON payload\n- **Processing:** Receive and validate webhook signature\n- **Output:** Raw subscription event data for processing\n\n---\n\n#### **Step 2: Document Properties (shape6)**\n\n**Component Type:** Document Properties\n\n**Purpose:** Set dynamic properties for customer name, subscription details, description, and close date calculations\n\n**Configuration Details:**\n\n- **Dynamic Properties:** 4 dynamic document properties calculated\n  - Dynamic Document Property - DDP_CustomerName: Process property for customer identification\n  - Dynamic Document Property - DDP_Subscription: Process property for subscription details\n  - Dynamic Document Property - DDP_SalesforceDescription: Process property for opportunity description\n  - Additional properties for data enrichment and calculations\n\n**Data Flow:**\n\n- **Input:** Raw Stripe webhook payload\n- **Processing:** Extract customer information, subscription details, calculate close dates, and prepare Salesforce-specific data\n- **Output:** Enhanced data with calculated dynamic properties for transformation\n\n---\n\n#### **Step 3: Transform/Map Component (shape4)**\n\n**Component Type:** Map/Transform\n\n**Purpose:** Transform Stripe subscription JSON data to Salesforce Opportunity XML format with dynamic property injection\n\n**Configuration Details:**\n\n- **Input Profile:** Subscription Completed JSON (Stripe webhook format)\n- **Output Profile:** SF Opportunity CREATE Request XML (Salesforce API format)\n- **Transformation Logic:** JSON to XML conversion with dynamic field population\n- **Function Steps:** DocumentPropertyGet functions for retrieving calculated properties\n\n**Field Mappings:**\n\n| Source Field | Target Field | Data Type | Business Purpose |\n|--------------|--------------|-----------|------------------|\n| Function Output (DDP_SalesforceDescription) | Opportunity/Description | String | Maps calculated description to Salesforce opportunity description |\n| Function Output (DDP_CustomerName) | Opportunity/Name | String | Maps extracted customer name to Salesforce opportunity name |\n| Function Output (DDP_CloseDate) | Opportunity/CloseDate | Date | Maps calculated close date to Salesforce opportunity close date |\n\n**Data Flow:**\n\n- **Input:** Stripe JSON payload with enhanced dynamic properties\n- **Processing:** Apply field mappings and execute DocumentPropertyGet functions\n- **Output:** Salesforce-compatible XML for opportunity creation\n\n---\n\n#### **Step 4: Salesforce Connector Action (shape3)**\n\n**Component Type:** Salesforce Connector\n\n**Purpose:** Create new Opportunity record in Salesforce using transformed data\n\n**Configuration Details:**\n\n- **Connector Type:** Salesforce\n- **Operation:** Create\n- **Target Object:** Opportunity\n- **Authentication:** OAuth 2.0 or session-based authentication\n- **Error Handling:** Standard Salesforce API error responses\n\n**Data Flow:**\n\n- **Input:** XML formatted opportunity data for creation\n- **Processing:** Execute Salesforce create operation via REST/SOAP API\n- **Output:** Salesforce response with created opportunity ID and status\n\n---\n\n#### **Step 5: End Event (shape5)**\n\n**Component Type:** End Event\n\n**Purpose:** Complete the integration process and provide final status\n\n**Configuration Details:**\n\n- **Completion Type:** Success completion after Salesforce operation\n- **Final Actions:** Log completion status and cleanup resources\n- **Continuation Settings:** Process stops after successful completion\n\n**Data Flow:**\n\n- **Input:** Salesforce create operation response\n- **Processing:** Log final status and cleanup temporary data\n- **Output:** Integration completion status and success confirmation\n\n---\n\n## Boomi Transformations Explained\n\n### Subscription Completed JSON to SF Opportunity CREATE Request XML\n\nThis transformation converts incoming Stripe webhook JSON payloads into Salesforce-compatible XML format for opportunity creation.\n\n**Input Profile:** Subscription Completed JSON\n- Stripe webhook event structure with subscription and customer data\n- JSON format with nested objects for subscription details\n- Event metadata including timestamps and event types\n\n**Output Profile:** SF Opportunity CREATE Request XML  \n- Salesforce Opportunity object XML structure\n- Required fields for opportunity creation\n- Properly formatted XML for Salesforce API consumption\n\n**Transformation Functions:**\n\n1. **Get Document Property (DDP_SalesforceDescription)**\n   - **Purpose:** Retrieve calculated description for Salesforce opportunity\n   - **Output:** Formatted description combining customer and subscription information\n\n2. **Get Document Property (DDP_CustomerName)**\n   - **Purpose:** Retrieve extracted customer name from subscription data\n   - **Output:** Customer name for opportunity identification\n\n3. **Get Document Property (DDP_CloseDate)**\n   - **Purpose:** Retrieve calculated close date for opportunity\n   - **Output:** Formatted date for Salesforce CloseDate field\n\n**Complete Field Mappings:**\n\n| Source Field | Target Field | Data Type | Business Purpose |\n|--------------|--------------|-----------|------------------|\n| DocumentPropertyGet (DDP_SalesforceDescription) | Opportunity/Description | String | Provides detailed opportunity description from subscription context |\n| DocumentPropertyGet (DDP_CustomerName) | Opportunity/Name | String | Sets opportunity name based on customer identification |\n| DocumentPropertyGet (DDP_CloseDate) | Opportunity/CloseDate | Date | Establishes opportunity close date based on subscription timeline |\n\n**Transformation Logic:**\n- Extract dynamic properties calculated in previous step\n- Apply DocumentPropertyGet functions to retrieve enhanced data\n- Map calculated values to appropriate Salesforce Opportunity fields\n- Generate properly formatted XML structure for Salesforce API\n\n## SAP Integration Suite Implementation\n\n### Component Mapping\n\n#### Main Process Component Mapping\n\n| Boomi Component | SAP Integration Suite Equivalent | Purpose |\n|-----------------|----------------------------------|---------|\n| Start Event (shape1) | Start Message Event (HTTPS Adapter) | Receive Stripe webhook notifications via HTTP |\n| Document Properties (shape6) | Content Modifier (Set Properties) | Calculate dynamic properties for customer and subscription data |\n| Transform/Map (shape4) | Message Mapping (JSON to XML) | Convert Stripe JSON payload to Salesforce XML format |\n| Salesforce Connector (shape3) | HTTPS Adapter (Request Reply) | Create Salesforce Opportunity via REST API |\n| End Event (shape5) | End Message Event | Complete integration process |\n\n### Integration Flow Visualization\n\n```mermaid\nflowchart TD\n    %% Define node styles for SAP Integration Suite components\n    classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px\n    classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px\n    classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px\n    classDef adapter fill:#FFD700,stroke:#333,stroke-width:2px\n    classDef event fill:#C0C0C0,stroke:#333,stroke-width:2px\n\n    %% Main Integration Flow\n    Start((\"Start Message Event\")) --> StripeWebhook[\"HTTPS Adapter: Stripe Webhook Receiver\"]:::httpAdapter\n    StripeWebhook --> SetDynamicProps[\"Content Modifier: Set Dynamic Properties\"]:::contentModifier\n    SetDynamicProps --> TransformData[\"Message Mapping: JSON to XML Transformation\"]:::mapping\n    TransformData --> SalesforceCreate[\"HTTPS Adapter: Salesforce Opportunity Creation\"]:::adapter\n    SalesforceCreate --> End((\"End Message Event\")):::event\n\n    %% Dynamic Properties Detail\n    subgraph DynamicProperties[\"Dynamic Properties Calculation\"]\n        ExtractCustomer[\"Extract Customer Name from Subscription\"]:::contentModifier\n        ExtractSubscription[\"Extract Subscription Details\"]:::contentModifier\n        BuildDescription[\"Build Salesforce Description\"]:::contentModifier\n        CalcCloseDate[\"Calculate Opportunity Close Date\"]:::contentModifier\n    end\n\n    SetDynamicProps --> DynamicProperties\n    DynamicProperties --> TransformData\n\n    %% Apply styling\n    class Start,End event\n    class StripeWebhook,SalesforceCreate httpAdapter\n    class SetDynamicProps,ExtractCustomer,ExtractSubscription,BuildDescription,CalcCloseDate contentModifier\n    class TransformData mapping\n```\n\n### Configuration Details\n\n#### HTTPS Adapter (Stripe Webhook Receiver)\n- **Connection Type:** HTTPS Inbound\n- **Address Pattern:** `/webhook/stripe/subscription`\n- **HTTP Method:** POST\n- **Content Type:** application/json\n- **Authentication:** Webhook signature verification\n\n#### Content Modifier (Set Dynamic Properties)\n- **Property Name:** DDP_CustomerName\n- **Property Value:** ${json-unit($.data.object.customer)}\n- **Property Name:** DDP_Subscription\n- **Property Value:** ${json-unit($.data.object.id)}\n- **Property Name:** DDP_SalesforceDescription\n- **Property Value:** Subscription ${property.DDP_Subscription} for customer ${property.DDP_CustomerName}\n- **Property Name:** DDP_CloseDate\n- **Property Value:** ${date:now:yyyy-MM-dd}\n\n#### Message Mapping (JSON to XML)\n- **Source Message Type:** Stripe_Subscription_JSON\n- **Target Message Type:** Salesforce_Opportunity_XML\n- **Mapping Logic:** Transform JSON webhook to Salesforce XML structure\n\n#### HTTPS Adapter (Salesforce)\n- **Connection Type:** HTTPS Outbound\n- **Address:** https://[instance].salesforce.com/services/data/v58.0/sobjects/Opportunity\n- **HTTP Method:** POST\n- **Authentication:** OAuth 2.0\n- **Content Type:** application/xml\n\n## Environment Configuration\n\n### Required Configuration Parameters\n\n| Parameter | Description | Example Value | Environment |\n|-----------|-------------|---------------|-------------|\n| STRIPE_WEBHOOK_SECRET | Stripe webhook signature verification | whsec_xxxxxxxxxxxxx | All |\n| SALESFORCE_CLIENT_ID | Salesforce connected app client ID | 3MVG9xxxxxxxxxxxxxxx | All |\n| SALESFORCE_CLIENT_SECRET | Salesforce connected app secret | 1234567890123456789 | All |\n| SALESFORCE_USERNAME | Salesforce integration user | integration@company.com | All |\n| SALESFORCE_PASSWORD | Salesforce user password + token | password123token456 | All |\n| SALESFORCE_INSTANCE_URL | Salesforce org instance URL | https://company.my.salesforce.com | All |\n\n### Dependencies on External Systems\n\n**Stripe Platform:**\n- Webhook endpoint configuration in Stripe dashboard\n- Webhook signature verification setup\n- Subscription event notification enabled\n\n**Salesforce CRM:**\n- Connected app configured with appropriate OAuth scopes\n- Integration user with Opportunity create permissions\n- Custom fields configured if required for mapping\n\n### Security Settings\n\n**Webhook Security:**\n- Stripe webhook signature verification mandatory\n- HTTPS-only communication for all endpoints\n- Request validation and sanitization\n\n**Salesforce Security:**\n- OAuth 2.0 authentication with refresh token handling\n- TLS 1.2+ for all API communications\n- IP restrictions on Salesforce connected app (if required)\n\n### Deployment Considerations\n\n**SAP Integration Suite Cloud:**\n- Minimum 2 worker nodes for high availability\n- Memory allocation: 1GB per integration flow\n- Timeout settings: 30 seconds for external API calls\n\n**Network Requirements:**\n- Outbound HTTPS access to Stripe and Salesforce\n- Webhook URL accessible from Stripe platform\n- DNS resolution for Salesforce instance URLs\n\n## API Reference\n\n### Stripe Webhook Events\n\n#### Subscription Events\n- **customer.subscription.created**: New subscription created\n- **customer.subscription.updated**: Subscription modified  \n- **customer.subscription.deleted**: Subscription cancelled\n\n### Salesforce Opportunity API\n\n#### Create Opportunity Endpoint\n- **Method:** POST\n- **URL:** `/services/data/v58.0/sobjects/Opportunity`\n- **Content-Type:** application/xml\n- **Authentication:** OAuth 2.0 Bearer token\n\n#### Required Opportunity Fields\n| Field Name | Data Type | Required | Description |\n|------------|-----------|----------|-------------|\n| Name | String(120) | Yes | Opportunity name |\n| CloseDate | Date | Yes | Expected close date |\n| StageName | String(40) | Yes | Current opportunity stage |\n\n#### Optional Opportunity Fields  \n| Field Name | Data Type | Required | Description |\n|------------|-----------|----------|-------------|\n| Description | String(32000) | No | Detailed opportunity description |\n| Amount | Currency | No | Expected opportunity value |\n| AccountId | ID | No | Associated account reference |\n\n### Error Codes and Handling\n\n| Error Code | Description | Resolution |\n|------------|-------------|------------|\n| 400 | Invalid webhook payload | Verify JSON structure and required fields |\n| 401 | Authentication failure | Refresh Salesforce OAuth token |\n| 403 | Insufficient permissions | Verify user permissions for Opportunity creation |\n| 500 | Salesforce API error | Check Salesforce system status and retry |\n\n### Rate Limiting\n\n**Salesforce API Limits:**\n- Daily API request limit based on Salesforce edition\n- Concurrent request limit: 25 per organization\n- Bulk API limits for high-volume scenarios\n\n**Integration Considerations:**\n- Implement exponential backoff for rate limit errors\n- Queue webhook processing during peak periods\n- Monitor API usage via Salesforce setup pages",
  "markdown_length": 17535,
  "constructed_query": "Create a complete SAP iFlow integration package named 'BoomiFlow_fecd618d' with the following requirements from the documentation:\n\n# Stripe Subscription to Salesforce Opportunity Integration\n\n## Table of Contents\n\n1. [API Overview](#api-overview)\n2. [Endpoints](#endpoints)\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\n   - [Process Flow Overview](#process-flow-overview)\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\n   - [Component Mapping](#component-mapping)\n   - [Integration Flow Visualization](#integration-flow-visualization)\n   - [Configuration Details](#configuration-details)\n6. [Environment Configuration](#environment-configuration)\n7. [API Reference](#api-reference)\n\n## API Overview\n\nThis integration provides automated creation of Salesforce Opportunities from Stripe subscription events. The integration listens for Stripe webhook notifications when subscription events occur and automatically creates corresponding Opportunity records in Salesforce with appropriate field mappings and data enrichment.\n\n**Business Purpose:** Streamline the sales-to-billing process by automatically creating sales opportunities in Salesforce when customers subscribe to services through Stripe, ensuring data consistency between the payment platform and CRM system.\n\n**Base Integration Pattern:** Event-driven webhook listener with real-time data transformation and CRM synchronization\n\n**Authentication:** \n- Stripe: Webhook signature verification\n- Salesforce: OAuth 2.0 or session-based authentication\n\n**Data Flow Direction:** Stripe → Boomi → Salesforce (unidirectional)\n\n**Response Format:** JSON webhook payload from Stripe transformed to XML for Salesforce API\n\n## Endpoints\n\n### Stripe Webhook Listener Endpoint\n\n**HTTP Method:** POST  \n**Purpose:** Receive Stripe subscription webhook notifications  \n**Endpoint Pattern:** `/webhook/stripe/subscription`  \n\n**Request Headers:**\n- `Content-Type: application/json`\n- `Stripe-Signature:\n\nGenerate a production-ready iFlow with proper:\n1. Start and End events\n2. Required adapters and connectors\n3. Content modifiers and processing steps\n4. Proper sequence flows\n5. Error handling\n6. SAP Integration Suite compliance\n",
  "query_length": 2362,
  "markdown_truncated_at": 2000,
  "api_endpoint": "/api/generate-iflow-from-markdown",
  "request_time": "2025-10-16T16:59:31.355625"
}