{
  "timestamp": "20251016_175505",
  "job_id": "b1a5a66a-a6b6-4c9c-b3dc-a0183070a2c6",
  "iflow_name": "BoomiFlow_9d15dede",
  "original_markdown": "# Stripe Subscription to Salesforce Opportunity Integration\n\n## Table of Contents\n\n1. [API Overview](#api-overview)\n2. [Endpoints](#endpoints)\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\n   - [Process Flow Overview](#process-flow-overview)\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\n   - [Component Mapping](#component-mapping)\n   - [Integration Flow Visualization](#integration-flow-visualization)\n   - [Configuration Details](#configuration-details)\n6. [Environment Configuration](#environment-configuration)\n7. [API Reference](#api-reference)\n\n## API Overview\n\nThis integration creates Salesforce Opportunities automatically when Stripe subscription events occur. The API serves as a webhook receiver for Stripe subscription completed events and transforms them into Salesforce Opportunity records.\n\n**Key Features:**\n- Real-time webhook processing from Stripe\n- Dynamic property calculation for opportunity data enrichment\n- Automatic Salesforce opportunity creation\n- JSON to XML transformation for Salesforce compatibility\n\n**Authentication:** \n- Stripe webhook signature validation\n- Salesforce OAuth 2.0 authentication\n\n**General Response Format:** \n- Input: Stripe webhook JSON payload\n- Output: Salesforce Opportunity creation response\n\n## Endpoints\n\n### Stripe Webhook Receiver\n- **HTTP Method:** POST\n- **Purpose:** Receives Stripe subscription completed webhook events\n- **Request Body:** Stripe subscription JSON payload with customer and subscription details\n- **Response Format:** HTTP status codes indicating processing success/failure\n- **Authentication:** Stripe webhook signature validation\n\n### Salesforce Opportunity Creation\n- **HTTP Method:** POST\n- **Purpose:** Creates new Opportunity records in Salesforce\n- **Request Body:** Salesforce Opportunity XML structure\n- **Response Format:** Salesforce SOAP response with created record ID\n- **Authentication:** Salesforce OAuth 2.0\n\n## Current Boomi Flow Logic\n\n### Process Flow Overview\n\nThis Boomi integration implements a webhook-driven pattern that:\n\n1. **Receives Stripe Events:** Listens for incoming Stripe subscription completed webhooks\n2. **Enriches Data:** Calculates dynamic properties for opportunity creation\n3. **Transforms Data:** Converts JSON webhook payload to Salesforce XML format\n4. **Creates Records:** Sends transformed data to Salesforce to create Opportunity records\n\nThe process handles real-time subscription events and ensures data consistency between Stripe and Salesforce systems.\n\n### Step-by-Step Flow Description\n\n---\n\n#### **Step 1: Stripe Webhook Listener (shape1)**\n\n**Component Type:** Start Event\n\n**Purpose:** Receives incoming Stripe subscription completed webhook events and initiates the integration process\n\n**Configuration Details:**\n\n- **Connector Type:** HTTP Listener/Web Services Server\n- **Operation:** Listen for POST requests from Stripe webhooks\n- **Input Profile:** Stripe subscription JSON payload\n- **Trigger Conditions:** Stripe subscription.completed events\n\n**Data Flow:**\n\n- **Input:** Stripe webhook JSON containing subscription and customer details\n- **Processing:** Validates webhook signature and parses JSON payload\n- **Output:** Structured subscription data ready for transformation\n\n---\n\n#### **Step 2: Set Dynamic Properties (shape6)**\n\n**Component Type:** Document Properties\n\n**Purpose:** Calculates and sets dynamic properties for opportunity creation including customer name, subscription details, and close date\n\n**Configuration Details:**\n\n- **Dynamic Properties:** 4 dynamic document properties calculated\n  - Dynamic Document Property - DDP_CustomerName: Process property: Dynamic Document Property - DDP_CustomerName\n  - Dynamic Document Property - DDP_Subscription: Process property: Dynamic Document Property - DDP_Subscription\n  - Dynamic Document Property - DDP_SalesforceDescription: Process property: Dynamic Document Property - DDP_SalesforceDescription\n  - Dynamic Document Property - DDP_CloseDate: Calculated close date for opportunity\n\n**Data Flow:**\n\n- **Input:** Stripe subscription JSON payload from webhook\n- **Processing:** Extracts customer information, calculates opportunity fields, and sets document properties\n- **Output:** Enhanced data with calculated properties for Salesforce opportunity creation\n\n---\n\n#### **Step 3: Transform Data (shape4)**\n\n**Component Type:** Map/Transform\n\n**Purpose:** Transforms Stripe subscription JSON data into Salesforce Opportunity XML format using dynamic properties\n\n**Configuration Details:**\n\n- **Input Profile:** Stripe subscription JSON structure\n- **Output Profile:** Salesforce Opportunity XML structure\n- **Transformation Logic:** Maps subscription data to opportunity fields using document properties\n- **Function Steps:** DocumentPropertyGet functions to retrieve calculated values\n\n**Data Flow:**\n\n- **Input:** Stripe subscription data with dynamic properties\n- **Processing:** Field-by-field mapping from JSON to XML with property substitution\n- **Output:** Salesforce-compatible Opportunity XML ready for creation\n\n---\n\n#### **Step 4: Database/Connector Action (shape3)**\n\n**Component Type:** Salesforce Connector\n\n**Purpose:** Creates the new Opportunity record in Salesforce using the transformed XML data\n\n**Configuration Details:**\n\n- **Connector Type:** Salesforce\n- **Operation:** Create\n- **Target Object:** Opportunity\n- **Authentication:** Salesforce OAuth 2.0\n- **Error Handling:** Standard Salesforce error responses\n\n**Data Flow:**\n\n- **Input:** Salesforce Opportunity XML structure\n- **Processing:** SOAP API call to create Opportunity record\n- **Output:** Salesforce response with created record ID or error details\n\n---\n\n#### **Step 5: Response Processing (shape5)**\n\n**Component Type:** End Event\n\n**Purpose:** Processes the Salesforce creation response and completes the integration flow\n\n**Configuration Details:**\n\n- **Completion Type:** Success or failure based on Salesforce response\n- **Final Actions:** Log creation results and send response to Stripe webhook\n- **Response Format:** HTTP status code back to Stripe\n\n**Data Flow:**\n\n- **Input:** Salesforce creation response\n- **Processing:** Validates successful creation and formats response\n- **Output:** HTTP response to Stripe webhook indicating processing completion\n\n## Boomi Transformations Explained\n\n### Subscription Completed JSON to SF Opportunity CREATE Request XML\n\n**Purpose:** This transformation converts incoming Stripe subscription webhook JSON data into the XML format required for Salesforce Opportunity creation.\n\n**Input Profile:** Stripe subscription JSON payload containing:\n- Customer information (name, email, metadata)\n- Subscription details (plan, amount, status)\n- Event metadata (timestamp, event type)\n\n**Output Profile:** Salesforce Opportunity XML structure with:\n- Opportunity Name\n- Description\n- Close Date\n- Other required Salesforce fields\n\n**Transformation Functions:**\n\n1. **Get Document Property (DDP_SalesforceDescription)**\n   - **Purpose:** Retrieves the calculated opportunity description\n   - **Output:** Formatted description combining customer and subscription details\n\n2. **Get Document Property (DDP_CustomerName)**\n   - **Purpose:** Retrieves the extracted customer name from subscription data\n   - **Output:** Customer name for opportunity identification\n\n3. **Get Document Property (DDP_CloseDate)**\n   - **Purpose:** Retrieves the calculated opportunity close date\n   - **Output:** Formatted date for Salesforce opportunity timeline\n\n**Field Mappings:**\n\n| Source Field | Target Field | Data Type | Business Purpose |\n|--------------|--------------|-----------|------------------|\n| DocumentProperty(DDP_CustomerName) | Opportunity/Name | String | Sets opportunity name based on customer |\n| DocumentProperty(DDP_SalesforceDescription) | Opportunity/Description | String | Provides detailed opportunity description |\n| DocumentProperty(DDP_CloseDate) | Opportunity/CloseDate | Date | Sets expected close date for sales pipeline |\n\n**Input Data Structure:**\n\n| Field Name | Data Type | Description |\n|------------|-----------|-------------|\n| customer.name | String | Customer name from Stripe |\n| subscription.plan.name | String | Subscription plan details |\n| subscription.amount | Number | Subscription amount |\n| created | Timestamp | Event creation time |\n\n**Output Data Structure:**\n\n| Field Name | Data Type | Description |\n|------------|-----------|-------------|\n| Opportunity/Name | String | Opportunity name |\n| Opportunity/Description | String | Detailed opportunity description |\n| Opportunity/CloseDate | Date | Expected close date |\n\n## SAP Integration Suite Implementation\n\n### Component Mapping\n\n#### Main Process Component Mapping\n\n| Boomi Component | SAP Integration Suite Equivalent | Purpose |\n|-----------------|----------------------------------|---------|\n| Start Event (shape1) | Start Message Event with HTTPS Adapter | Receives Stripe webhook events |\n| Document Properties (shape6) | Content Modifier (Set Properties) | Calculates dynamic opportunity properties |\n| Map Transform (shape4) | Message Mapping | Transforms JSON to XML for Salesforce |\n| Connector Action (shape3) | Request Reply with Salesforce Adapter | Creates Salesforce Opportunity records |\n| End Event (shape5) | End Message Event | Completes the integration flow |\n\n### Integration Flow Visualization\n\n```mermaid\nflowchart TD\n    %% Define node styles for SAP Integration Suite components\n    classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px\n    classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px\n    classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px\n    classDef adapter fill:#FFD700,stroke:#333,stroke-width:2px\n    classDef event fill:#C0C0C0,stroke:#333,stroke-width:2px\n    classDef errorHandler fill:#FFA07A,stroke:#333,stroke-width:2px\n\n    %% Main Integration Flow\n    Start((\"Start Message Event\")):::event\n    StripeWebhook[\"HTTPS Adapter: Stripe Webhook Receiver\"]:::httpAdapter\n    SetDynamicProps[\"Content Modifier: Set Dynamic Properties\"]:::contentModifier\n    TransformData[\"Message Mapping: JSON to Salesforce XML\"]:::mapping\n    SalesforceCreate[\"Salesforce Adapter: Create Opportunity\"]:::adapter\n    End((\"End Message Event\")):::event\n\n    %% Flow connections\n    Start --> StripeWebhook\n    StripeWebhook --> SetDynamicProps\n    SetDynamicProps --> TransformData\n    TransformData --> SalesforceCreate\n    SalesforceCreate --> End\n\n    %% Dynamic Properties Detail\n    subgraph DynamicProperties[\"Dynamic Properties Calculation\"]\n        ExtractCustomer[\"Extract Customer Name from JSON\"]:::contentModifier\n        BuildDescription[\"Build Opportunity Description\"]:::contentModifier\n        CalcCloseDate[\"Calculate Close Date\"]:::contentModifier\n        SetSubscriptionData[\"Set Subscription Details\"]:::contentModifier\n    end\n\n    SetDynamicProps -.-> DynamicProperties\n\n    %% Apply styling\n    class StripeWebhook httpAdapter\n    class SetDynamicProps,ExtractCustomer,BuildDescription,CalcCloseDate,SetSubscriptionData contentModifier\n    class TransformData mapping\n    class SalesforceCreate adapter\n    class Start,End event\n```\n\n### Configuration Details\n\n#### HTTPS Adapter Configuration (Stripe Webhook Receiver)\n- **Address:** `/stripe/webhook`\n- **HTTP Method:** POST\n- **Authentication:** Stripe webhook signature validation\n- **Content Type:** application/json\n- **Required Headers:** Stripe-Signature for webhook validation\n\n#### Content Modifier Configuration (Dynamic Properties)\n- **DDP_CustomerName:** Extract from `$.customer.name` or `$.customer.email`\n- **DDP_Subscription:** Extract subscription details from `$.subscription`\n- **DDP_SalesforceDescription:** Concatenate customer and subscription information\n- **DDP_CloseDate:** Calculate date 90 days from current date\n\n#### Message Mapping Configuration\n- **Source Message Type:** Stripe Subscription JSON\n- **Target Message Type:** Salesforce Opportunity XML\n- **Mapping Functions:** Property access functions for dynamic values\n\n#### Salesforce Adapter Configuration\n- **Operation:** Create\n- **Object:** Opportunity\n- **Authentication:** OAuth 2.0 with refresh token\n- **API Version:** Latest Salesforce API version\n- **Required Fields:** Name, CloseDate, StageName (default to \"Prospecting\")\n\n## Environment Configuration\n\n### Required Configuration Parameters\n- **Stripe Webhook Secret:** For signature validation\n- **Salesforce Username:** OAuth authentication\n- **Salesforce Password:** OAuth authentication\n- **Salesforce Security Token:** API access\n- **Salesforce Client ID:** Connected app credentials\n- **Salesforce Client Secret:** Connected app credentials\n\n### Environment Variables\n\n| Variable Name | Description | Example Value |\n|---------------|-------------|---------------|\n| STRIPE_WEBHOOK_SECRET | Stripe webhook endpoint secret | `whsec_...` |\n| SALESFORCE_USERNAME | Salesforce integration user | `integration@company.com` |\n| SALESFORCE_PASSWORD | Salesforce user password | `password123` |\n| SALESFORCE_TOKEN | Salesforce security token | `ABC123...` |\n| SALESFORCE_CLIENT_ID | Connected app consumer key | `3MVG9...` |\n| SALESFORCE_CLIENT_SECRET | Connected app consumer secret | `123456...` |\n\n### Security Settings\n- **TLS Encryption:** Required for all external communications\n- **Webhook Signature Validation:** Stripe webhook signature verification\n- **OAuth 2.0:** Salesforce authentication with refresh token handling\n- **IP Restrictions:** Limit access to known Stripe IP ranges\n\n### Deployment Considerations\n- **Memory Requirements:** 2GB minimum for JSON/XML processing\n- **CPU Requirements:** 2 cores for concurrent webhook processing\n- **Network Requirements:** Outbound HTTPS to Stripe and Salesforce\n- **Storage Requirements:** Minimal temporary storage for message processing\n\n## API Reference\n\n### Stripe Webhook Endpoint\n\n**POST /stripe/webhook**\n\n**Description:** Receives Stripe subscription completed events\n\n**Headers:**\n- `Stripe-Signature`: Webhook signature for validation\n- `Content-Type`: application/json\n\n**Request Body Schema:**\n```json\n{\n  \"id\": \"evt_...\",\n  \"type\": \"customer.subscription.created\",\n  \"data\": {\n    \"object\": {\n      \"id\": \"sub_...\",\n      \"customer\": \"cus_...\",\n      \"status\": \"active\",\n      \"current_period_start\": 1234567890,\n      \"current_period_end\": 1234567890\n    }\n  }\n}\n```\n\n**Response Codes:**\n- `200 OK`: Webhook processed successfully\n- `400 Bad Request`: Invalid webhook format\n- `401 Unauthorized`: Invalid signature\n- `500 Internal Server Error`: Processing failure\n\n### Salesforce Opportunity Creation\n\n**Operation:** create\n**Object:** Opportunity\n\n**Request Fields:**\n- `Name` (String, Required): Opportunity name\n- `Description` (String): Detailed description\n- `CloseDate` (Date, Required): Expected close date\n- `StageName` (String, Required): Sales stage (default: \"Prospecting\")\n\n**Response:**\n- Success: Created record ID\n- Error: Salesforce error details with error codes and messages\n\n### Error Codes\n\n| Code | Description | Resolution |\n|------|-------------|------------|\n| WEBHOOK_VALIDATION_FAILED | Invalid Stripe signature | Check webhook secret configuration |\n| SALESFORCE_AUTH_FAILED | Salesforce authentication error | Verify credentials and refresh token |\n| MAPPING_ERROR | Data transformation failure | Check field mappings and data format |\n| SALESFORCE_CREATE_FAILED | Opportunity creation failed | Review Salesforce validation rules |",
  "markdown_length": 15626,
  "constructed_query": "Create a complete SAP iFlow integration package named 'BoomiFlow_9d15dede' with the following requirements from the documentation:\n\n# Stripe Subscription to Salesforce Opportunity Integration\n\n## Table of Contents\n\n1. [API Overview](#api-overview)\n2. [Endpoints](#endpoints)\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\n   - [Process Flow Overview](#process-flow-overview)\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\n   - [Component Mapping](#component-mapping)\n   - [Integration Flow Visualization](#integration-flow-visualization)\n   - [Configuration Details](#configuration-details)\n6. [Environment Configuration](#environment-configuration)\n7. [API Reference](#api-reference)\n\n## API Overview\n\nThis integration creates Salesforce Opportunities automatically when Stripe subscription events occur. The API serves as a webhook receiver for Stripe subscription completed events and transforms them into Salesforce Opportunity records.\n\n**Key Features:**\n- Real-time webhook processing from Stripe\n- Dynamic property calculation for opportunity data enrichment\n- Automatic Salesforce opportunity creation\n- JSON to XML transformation for Salesforce compatibility\n\n**Authentication:** \n- Stripe webhook signature validation\n- Salesforce OAuth 2.0 authentication\n\n**General Response Format:** \n- Input: Stripe webhook JSON payload\n- Output: Salesforce Opportunity creation response\n\n## Endpoints\n\n### Stripe Webhook Receiver\n- **HTTP Method:** POST\n- **Purpose:** Receives Stripe subscription completed webhook events\n- **Request Body:** Stripe subscription JSON payload with customer and subscription details\n- **Response Format:** HTTP status codes indicating processing success/failure\n- **Authentication:** Stripe webhook signature validation\n\n### Salesforce Opportunity Creation\n- **HTTP Method:** POST\n- **Purpose:** Creates new Opportunity records in Salesforce\n- **Request Body:** Salesforce Opportunity XML structure\n- **Response Format\n\nGenerate a production-ready iFlow with proper:\n1. Start and End events\n2. Required adapters and connectors\n3. Content modifiers and processing steps\n4. Proper sequence flows\n5. Error handling\n6. SAP Integration Suite compliance\n",
  "query_length": 2362,
  "markdown_truncated_at": 2000,
  "api_endpoint": "/api/generate-iflow-from-markdown",
  "request_time": "2025-10-16T17:55:05.742675"
}