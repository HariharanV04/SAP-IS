{
  "timestamp": "20251016_175516",
  "job_id": "36043038-1bf1-41a9-ab1b-371079026fc6",
  "iflow_name": "IFlow_9d15dede",
  "original_markdown": "# Stripe Subscription to Salesforce Opportunity Integration\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration creates Salesforce Opportunities automatically when Stripe subscription events occur. The API serves as a webhook receiver for Stripe subscription completed events and transforms them into Salesforce Opportunity records.\r\n\r\n**Key Features:**\r\n- Real-time webhook processing from Stripe\r\n- Dynamic property calculation for opportunity data enrichment\r\n- Automatic Salesforce opportunity creation\r\n- JSON to XML transformation for Salesforce compatibility\r\n\r\n**Authentication:** \r\n- Stripe webhook signature validation\r\n- Salesforce OAuth 2.0 authentication\r\n\r\n**General Response Format:** \r\n- Input: Stripe webhook JSON payload\r\n- Output: Salesforce Opportunity creation response\r\n\r\n## Endpoints\r\n\r\n### Stripe Webhook Receiver\r\n- **HTTP Method:** POST\r\n- **Purpose:** Receives Stripe subscription completed webhook events\r\n- **Request Body:** Stripe subscription JSON payload with customer and subscription details\r\n- **Response Format:** HTTP status codes indicating processing success/failure\r\n- **Authentication:** Stripe webhook signature validation\r\n\r\n### Salesforce Opportunity Creation\r\n- **HTTP Method:** POST\r\n- **Purpose:** Creates new Opportunity records in Salesforce\r\n- **Request Body:** Salesforce Opportunity XML structure\r\n- **Response Format:** Salesforce SOAP response with created record ID\r\n- **Authentication:** Salesforce OAuth 2.0\r\n\r\n## Current Boomi Flow Logic\r\n\r\n### Process Flow Overview\r\n\r\nThis Boomi integration implements a webhook-driven pattern that:\r\n\r\n1. **Receives Stripe Events:** Listens for incoming Stripe subscription completed webhooks\r\n2. **Enriches Data:** Calculates dynamic properties for opportunity creation\r\n3. **Transforms Data:** Converts JSON webhook payload to Salesforce XML format\r\n4. **Creates Records:** Sends transformed data to Salesforce to create Opportunity records\r\n\r\nThe process handles real-time subscription events and ensures data consistency between Stripe and Salesforce systems.\r\n\r\n### Step-by-Step Flow Description\r\n\r\n---\r\n\r\n#### **Step 1: Stripe Webhook Listener (shape1)**\r\n\r\n**Component Type:** Start Event\r\n\r\n**Purpose:** Receives incoming Stripe subscription completed webhook events and initiates the integration process\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** HTTP Listener/Web Services Server\r\n- **Operation:** Listen for POST requests from Stripe webhooks\r\n- **Input Profile:** Stripe subscription JSON payload\r\n- **Trigger Conditions:** Stripe subscription.completed events\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe webhook JSON containing subscription and customer details\r\n- **Processing:** Validates webhook signature and parses JSON payload\r\n- **Output:** Structured subscription data ready for transformation\r\n\r\n---\r\n\r\n#### **Step 2: Set Dynamic Properties (shape6)**\r\n\r\n**Component Type:** Document Properties\r\n\r\n**Purpose:** Calculates and sets dynamic properties for opportunity creation including customer name, subscription details, and close date\r\n\r\n**Configuration Details:**\r\n\r\n- **Dynamic Properties:** 4 dynamic document properties calculated\r\n  - Dynamic Document Property - DDP_CustomerName: Process property: Dynamic Document Property - DDP_CustomerName\r\n  - Dynamic Document Property - DDP_Subscription: Process property: Dynamic Document Property - DDP_Subscription\r\n  - Dynamic Document Property - DDP_SalesforceDescription: Process property: Dynamic Document Property - DDP_SalesforceDescription\r\n  - Dynamic Document Property - DDP_CloseDate: Calculated close date for opportunity\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe subscription JSON payload from webhook\r\n- **Processing:** Extracts customer information, calculates opportunity fields, and sets document properties\r\n- **Output:** Enhanced data with calculated properties for Salesforce opportunity creation\r\n\r\n---\r\n\r\n#### **Step 3: Transform Data (shape4)**\r\n\r\n**Component Type:** Map/Transform\r\n\r\n**Purpose:** Transforms Stripe subscription JSON data into Salesforce Opportunity XML format using dynamic properties\r\n\r\n**Configuration Details:**\r\n\r\n- **Input Profile:** Stripe subscription JSON structure\r\n- **Output Profile:** Salesforce Opportunity XML structure\r\n- **Transformation Logic:** Maps subscription data to opportunity fields using document properties\r\n- **Function Steps:** DocumentPropertyGet functions to retrieve calculated values\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe subscription data with dynamic properties\r\n- **Processing:** Field-by-field mapping from JSON to XML with property substitution\r\n- **Output:** Salesforce-compatible Opportunity XML ready for creation\r\n\r\n---\r\n\r\n#### **Step 4: Database/Connector Action (shape3)**\r\n\r\n**Component Type:** Salesforce Connector\r\n\r\n**Purpose:** Creates the new Opportunity record in Salesforce using the transformed XML data\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Salesforce\r\n- **Operation:** Create\r\n- **Target Object:** Opportunity\r\n- **Authentication:** Salesforce OAuth 2.0\r\n- **Error Handling:** Standard Salesforce error responses\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce Opportunity XML structure\r\n- **Processing:** SOAP API call to create Opportunity record\r\n- **Output:** Salesforce response with created record ID or error details\r\n\r\n---\r\n\r\n#### **Step 5: Response Processing (shape5)**\r\n\r\n**Component Type:** End Event\r\n\r\n**Purpose:** Processes the Salesforce creation response and completes the integration flow\r\n\r\n**Configuration Details:**\r\n\r\n- **Completion Type:** Success or failure based on Salesforce response\r\n- **Final Actions:** Log creation results and send response to Stripe webhook\r\n- **Response Format:** HTTP status code back to Stripe\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce creation response\r\n- **Processing:** Validates successful creation and formats response\r\n- **Output:** HTTP response to Stripe webhook indicating processing completion\r\n\r\n## Boomi Transformations Explained\r\n\r\n### Subscription Completed JSON to SF Opportunity CREATE Request XML\r\n\r\n**Purpose:** This transformation converts incoming Stripe subscription webhook JSON data into the XML format required for Salesforce Opportunity creation.\r\n\r\n**Input Profile:** Stripe subscription JSON payload containing:\r\n- Customer information (name, email, metadata)\r\n- Subscription details (plan, amount, status)\r\n- Event metadata (timestamp, event type)\r\n\r\n**Output Profile:** Salesforce Opportunity XML structure with:\r\n- Opportunity Name\r\n- Description\r\n- Close Date\r\n- Other required Salesforce fields\r\n\r\n**Transformation Functions:**\r\n\r\n1. **Get Document Property (DDP_SalesforceDescription)**\r\n   - **Purpose:** Retrieves the calculated opportunity description\r\n   - **Output:** Formatted description combining customer and subscription details\r\n\r\n2. **Get Document Property (DDP_CustomerName)**\r\n   - **Purpose:** Retrieves the extracted customer name from subscription data\r\n   - **Output:** Customer name for opportunity identification\r\n\r\n3. **Get Document Property (DDP_CloseDate)**\r\n   - **Purpose:** Retrieves the calculated opportunity close date\r\n   - **Output:** Formatted date for Salesforce opportunity timeline\r\n\r\n**Field Mappings:**\r\n\r\n| Source Field | Target Field | Data Type | Business Purpose |\r\n|--------------|--------------|-----------|------------------|\r\n| DocumentProperty(DDP_CustomerName) | Opportunity/Name | String | Sets opportunity name based on customer |\r\n| DocumentProperty(DDP_SalesforceDescription) | Opportunity/Description | String | Provides detailed opportunity description |\r\n| DocumentProperty(DDP_CloseDate) | Opportunity/CloseDate | Date | Sets expected close date for sales pipeline |\r\n\r\n**Input Data Structure:**\r\n\r\n| Field Name | Data Type | Description |\r\n|------------|-----------|-------------|\r\n| customer.name | String | Customer name from Stripe |\r\n| subscription.plan.name | String | Subscription plan details |\r\n| subscription.amount | Number | Subscription amount |\r\n| created | Timestamp | Event creation time |\r\n\r\n**Output Data Structure:**\r\n\r\n| Field Name | Data Type | Description |\r\n|------------|-----------|-------------|\r\n| Opportunity/Name | String | Opportunity name |\r\n| Opportunity/Description | String | Detailed opportunity description |\r\n| Opportunity/CloseDate | Date | Expected close date |\r\n\r\n## SAP Integration Suite Implementation\r\n\r\n### Component Mapping\r\n\r\n#### Main Process Component Mapping\r\n\r\n| Boomi Component | SAP Integration Suite Equivalent | Purpose |\r\n|-----------------|----------------------------------|---------|\r\n| Start Event (shape1) | Start Message Event with HTTPS Adapter | Receives Stripe webhook events |\r\n| Document Properties (shape6) | Content Modifier (Set Properties) | Calculates dynamic opportunity properties |\r\n| Map Transform (shape4) | Message Mapping | Transforms JSON to XML for Salesforce |\r\n| Connector Action (shape3) | Request Reply with Salesforce Adapter | Creates Salesforce Opportunity records |\r\n| End Event (shape5) | End Message Event | Completes the integration flow |\r\n\r\n### Integration Flow Visualization\r\n\r\n```mermaid\r\nflowchart TD\r\n    %% Define node styles for SAP Integration Suite components\r\n    classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px\r\n    classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px\r\n    classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px\r\n    classDef adapter fill:#FFD700,stroke:#333,stroke-width:2px\r\n    classDef event fill:#C0C0C0,stroke:#333,stroke-width:2px\r\n    classDef errorHandler fill:#FFA07A,stroke:#333,stroke-width:2px\r\n\r\n    %% Main Integration Flow\r\n    Start((\"Start Message Event\")):::event\r\n    StripeWebhook[\"HTTPS Adapter: Stripe Webhook Receiver\"]:::httpAdapter\r\n    SetDynamicProps[\"Content Modifier: Set Dynamic Properties\"]:::contentModifier\r\n    TransformData[\"Message Mapping: JSON to Salesforce XML\"]:::mapping\r\n    SalesforceCreate[\"Salesforce Adapter: Create Opportunity\"]:::adapter\r\n    End((\"End Message Event\")):::event\r\n\r\n    %% Flow connections\r\n    Start --> StripeWebhook\r\n    StripeWebhook --> SetDynamicProps\r\n    SetDynamicProps --> TransformData\r\n    TransformData --> SalesforceCreate\r\n    SalesforceCreate --> End\r\n\r\n    %% Dynamic Properties Detail\r\n    subgraph DynamicProperties[\"Dynamic Properties Calculation\"]\r\n        ExtractCustomer[\"Extract Customer Name from JSON\"]:::contentModifier\r\n        BuildDescription[\"Build Opportunity Description\"]:::contentModifier\r\n        CalcCloseDate[\"Calculate Close Date\"]:::contentModifier\r\n        SetSubscriptionData[\"Set Subscription Details\"]:::contentModifier\r\n    end\r\n\r\n    SetDynamicProps -.-> DynamicProperties\r\n\r\n    %% Apply styling\r\n    class StripeWebhook httpAdapter\r\n    class SetDynamicProps,ExtractCustomer,BuildDescription,CalcCloseDate,SetSubscriptionData contentModifier\r\n    class TransformData mapping\r\n    class SalesforceCreate adapter\r\n    class Start,End event\r\n```\r\n\r\n### Configuration Details\r\n\r\n#### HTTPS Adapter Configuration (Stripe Webhook Receiver)\r\n- **Address:** `/stripe/webhook`\r\n- **HTTP Method:** POST\r\n- **Authentication:** Stripe webhook signature validation\r\n- **Content Type:** application/json\r\n- **Required Headers:** Stripe-Signature for webhook validation\r\n\r\n#### Content Modifier Configuration (Dynamic Properties)\r\n- **DDP_CustomerName:** Extract from `$.customer.name` or `$.customer.email`\r\n- **DDP_Subscription:** Extract subscription details from `$.subscription`\r\n- **DDP_SalesforceDescription:** Concatenate customer and subscription information\r\n- **DDP_CloseDate:** Calculate date 90 days from current date\r\n\r\n#### Message Mapping Configuration\r\n- **Source Message Type:** Stripe Subscription JSON\r\n- **Target Message Type:** Salesforce Opportunity XML\r\n- **Mapping Functions:** Property access functions for dynamic values\r\n\r\n#### Salesforce Adapter Configuration\r\n- **Operation:** Create\r\n- **Object:** Opportunity\r\n- **Authentication:** OAuth 2.0 with refresh token\r\n- **API Version:** Latest Salesforce API version\r\n- **Required Fields:** Name, CloseDate, StageName (default to \"Prospecting\")\r\n\r\n## Environment Configuration\r\n\r\n### Required Configuration Parameters\r\n- **Stripe Webhook Secret:** For signature validation\r\n- **Salesforce Username:** OAuth authentication\r\n- **Salesforce Password:** OAuth authentication\r\n- **Salesforce Security Token:** API access\r\n- **Salesforce Client ID:** Connected app credentials\r\n- **Salesforce Client Secret:** Connected app credentials\r\n\r\n### Environment Variables\r\n\r\n| Variable Name | Description | Example Value |\r\n|---------------|-------------|---------------|\r\n| STRIPE_WEBHOOK_SECRET | Stripe webhook endpoint secret | `whsec_...` |\r\n| SALESFORCE_USERNAME | Salesforce integration user | `integration@company.com` |\r\n| SALESFORCE_PASSWORD | Salesforce user password | `password123` |\r\n| SALESFORCE_TOKEN | Salesforce security token | `ABC123...` |\r\n| SALESFORCE_CLIENT_ID | Connected app consumer key | `3MVG9...` |\r\n| SALESFORCE_CLIENT_SECRET | Connected app consumer secret | `123456...` |\r\n\r\n### Security Settings\r\n- **TLS Encryption:** Required for all external communications\r\n- **Webhook Signature Validation:** Stripe webhook signature verification\r\n- **OAuth 2.0:** Salesforce authentication with refresh token handling\r\n- **IP Restrictions:** Limit access to known Stripe IP ranges\r\n\r\n### Deployment Considerations\r\n- **Memory Requirements:** 2GB minimum for JSON/XML processing\r\n- **CPU Requirements:** 2 cores for concurrent webhook processing\r\n- **Network Requirements:** Outbound HTTPS to Stripe and Salesforce\r\n- **Storage Requirements:** Minimal temporary storage for message processing\r\n\r\n## API Reference\r\n\r\n### Stripe Webhook Endpoint\r\n\r\n**POST /stripe/webhook**\r\n\r\n**Description:** Receives Stripe subscription completed events\r\n\r\n**Headers:**\r\n- `Stripe-Signature`: Webhook signature for validation\r\n- `Content-Type`: application/json\r\n\r\n**Request Body Schema:**\r\n```json\r\n{\r\n  \"id\": \"evt_...\",\r\n  \"type\": \"customer.subscription.created\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"sub_...\",\r\n      \"customer\": \"cus_...\",\r\n      \"status\": \"active\",\r\n      \"current_period_start\": 1234567890,\r\n      \"current_period_end\": 1234567890\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Response Codes:**\r\n- `200 OK`: Webhook processed successfully\r\n- `400 Bad Request`: Invalid webhook format\r\n- `401 Unauthorized`: Invalid signature\r\n- `500 Internal Server Error`: Processing failure\r\n\r\n### Salesforce Opportunity Creation\r\n\r\n**Operation:** create\r\n**Object:** Opportunity\r\n\r\n**Request Fields:**\r\n- `Name` (String, Required): Opportunity name\r\n- `Description` (String): Detailed description\r\n- `CloseDate` (Date, Required): Expected close date\r\n- `StageName` (String, Required): Sales stage (default: \"Prospecting\")\r\n\r\n**Response:**\r\n- Success: Created record ID\r\n- Error: Salesforce error details with error codes and messages\r\n\r\n### Error Codes\r\n\r\n| Code | Description | Resolution |\r\n|------|-------------|------------|\r\n| WEBHOOK_VALIDATION_FAILED | Invalid Stripe signature | Check webhook secret configuration |\r\n| SALESFORCE_AUTH_FAILED | Salesforce authentication error | Verify credentials and refresh token |\r\n| MAPPING_ERROR | Data transformation failure | Check field mappings and data format |\r\n| SALESFORCE_CREATE_FAILED | Opportunity creation failed | Review Salesforce validation rules |",
  "markdown_length": 16030,
  "constructed_query": "Create a complete SAP iFlow integration package named 'IFlow_9d15dede' with the following requirements from the documentation:\n\n# Stripe Subscription to Salesforce Opportunity Integration\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration creates Salesforce Opportunities automatically when Stripe subscription events occur. The API serves as a webhook receiver for Stripe subscription completed events and transforms them into Salesforce Opportunity records.\r\n\r\n**Key Features:**\r\n- Real-time webhook processing from Stripe\r\n- Dynamic property calculation for opportunity data enrichment\r\n- Automatic Salesforce opportunity creation\r\n- JSON to XML transformation for Salesforce compatibility\r\n\r\n**Authentication:** \r\n- Stripe webhook signature validation\r\n- Salesforce OAuth 2.0 authentication\r\n\r\n**General Response Format:** \r\n- Input: Stripe webhook JSON payload\r\n- Output: Salesforce Opportunity creation response\r\n\r\n## Endpoints\r\n\r\n### Stripe Webhook Receiver\r\n- **HTTP Method:** POST\r\n- **Purpose:** Receives Stripe subscription completed webhook events\r\n- **Request Body:** Stripe subscription JSON payload with customer and subscription details\r\n- **Response Format:** HTTP status codes indicating processing success/failure\r\n- **Authentication:** Stripe webhook signature validation\r\n\r\n### Salesforce Opportunity Creation\r\n- **HTTP Method:** POST\r\n- **Purpose:** Creates new Opportunity records in Salesforce\r\n- **Request Body:** Salesforc\n\nGenerate a production-ready iFlow with proper:\n1. Start and End events\n2. Required adapters and connectors\n3. Content modifiers and processing steps\n4. Proper sequence flows\n5. Error handling\n6. SAP Integration Suite compliance\n",
  "query_length": 2358,
  "markdown_truncated_at": 2000,
  "api_endpoint": "/api/generate-iflow-from-markdown",
  "request_time": "2025-10-16T17:55:16.203723"
}