{
  "timestamp": "20251023_182532",
  "job_id": null,
  "iflow_name": "IFlow_a93feac2",
  "original_markdown": "# Create Salesforce Opportunities from Stripe Subscriptions Integration\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n   - [Stripe Webhook Endpoint](#stripe-webhook-endpoint)\r\n   - [Salesforce Opportunity Creation Endpoint](#salesforce-opportunity-creation-endpoint)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n   - [Subscription Completed JSON to SF Opportunity CREATE Request XML](#subscription-completed-json-to-sf-opportunity-create-request-xml)\r\n   - [Field Mappings](#field-mappings)\r\n   - [Transformation Functions](#transformation-functions)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n   - [Stripe Subscription Events](#stripe-subscription-events)\r\n   - [Salesforce Opportunity API](#salesforce-opportunity-api)\r\n\r\n## API Overview\r\n\r\nThis integration provides a real-time synchronization mechanism between Stripe subscription events and Salesforce opportunity creation. The integration is designed to automatically create Salesforce opportunities when specific Stripe subscription events occur, ensuring seamless data flow between the payment processing system and CRM.\r\n\r\n**Key Capabilities:**\r\n- Real-time webhook processing from Stripe subscription events\r\n- Dynamic property calculation and data enrichment\r\n- Automated Salesforce opportunity creation with proper field mapping\r\n- Error handling and logging for subscription processing failures\r\n\r\n**Base URL Pattern:**\r\n- Stripe Webhook Listener: `https://[boomi-runtime]/ws/simple/createSalesforceOpportunities`\r\n- Salesforce API: `https://[salesforce-instance].salesforce.com/services/data/v[version]/sobjects/Opportunity`\r\n\r\n**Authentication:**\r\n- Stripe: Webhook signature verification\r\n- Salesforce: OAuth 2.0 or SOAP session-based authentication\r\n\r\n**Response Format:**\r\n- Input: JSON (Stripe webhook payload)\r\n- Output: XML (Salesforce SOAP API response)\r\n\r\n## Endpoints\r\n\r\n### Stripe Webhook Endpoint\r\n\r\n**HTTP Method:** POST\r\n**Path:** `/ws/simple/createSalesforceOpportunities`\r\n\r\n**Purpose:** Receives Stripe subscription webhook events and initiates the opportunity creation process.\r\n\r\n**Request Headers:**\r\n- `Content-Type: application/json`\r\n- `Stripe-Signature: [webhook signature]`\r\n\r\n**Request Body Structure:**\r\n```json\r\n{\r\n  \"id\": \"evt_subscription_id\",\r\n  \"object\": \"event\",\r\n  \"type\": \"customer.subscription.created\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"sub_subscription_id\",\r\n      \"customer\": \"cus_customer_id\",\r\n      \"items\": {\r\n        \"data\": [\r\n          {\r\n            \"price\": {\r\n              \"product\": \"prod_product_id\"\r\n            }\r\n          }\r\n        ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Response Format:**\r\n- **200 OK:** Successful processing with opportunity creation confirmation\r\n- **400 Bad Request:** Invalid webhook payload or signature\r\n- **500 Internal Server Error:** Processing error during opportunity creation\r\n\r\n### Salesforce Opportunity Creation Endpoint\r\n\r\n**HTTP Method:** POST  \r\n**Path:** `/services/data/v[version]/sobjects/Opportunity`\r\n\r\n**Purpose:** Creates new opportunity records in Salesforce based on processed Stripe subscription data.\r\n\r\n**Request Headers:**\r\n- `Authorization: Bearer [access_token]`\r\n- `Content-Type: application/xml`\r\n\r\n**Request Body Structure:**\r\n```xml\r\n<sObjects>\r\n  <Opportunity>\r\n    <Name>[Dynamic Customer Name]</Name>\r\n    <Description>[Dynamic Salesforce Description]</Description>\r\n    <CloseDate>[Calculated Close Date]</CloseDate>\r\n  </Opportunity>\r\n</sObjects>\r\n```\r\n\r\n**Response Format:**\r\n- **201 Created:** Opportunity successfully created\r\n- **400 Bad Request:** Invalid opportunity data\r\n- **401 Unauthorized:** Authentication failure\r\n\r\n## Current Boomi Flow Logic\r\n\r\n### Process Flow Overview\r\n\r\nThis Boomi integration implements an event-driven architecture that processes Stripe subscription webhooks and creates corresponding Salesforce opportunities. The process begins with a webhook listener that receives Stripe subscription events, enriches the data through dynamic property calculations, transforms the JSON payload to XML format, and finally creates opportunities in Salesforce.\r\n\r\n**Main Processing Steps:**\r\n1. **Webhook Reception:** Listen for incoming Stripe subscription events\r\n2. **Dynamic Property Calculation:** Enrich data with customer names, descriptions, and calculated dates\r\n3. **Data Transformation:** Convert JSON webhook payload to Salesforce XML format\r\n4. **Opportunity Creation:** Send transformed data to Salesforce for opportunity creation\r\n5. **Response Processing:** Handle success/error responses from Salesforce\r\n\r\n### Step-by-Step Flow Description\r\n\r\n---\r\n\r\n#### **Step 1: Start Event (shape1)**\r\n\r\n**Component Type:** Start Event (Web Services Server)\r\n\r\n**Purpose:** Listens for incoming Stripe webhook events containing subscription data\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Web Services Server\r\n- **Operation:** Listen for HTTP POST requests\r\n- **Input Profile:** JSON webhook payload from Stripe\r\n- **Trigger Conditions:** Incoming HTTP requests to the webhook endpoint\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe subscription webhook JSON payload\r\n- **Processing:** Validates webhook signature and parses JSON structure\r\n- **Output:** Parsed subscription event data ready for property enhancement\r\n\r\n---\r\n\r\n#### **Step 2: Document Properties (shape6)**\r\n\r\n**Component Type:** Document Properties\r\n\r\n**Purpose:** Set dynamic properties for customer information, subscription details, and calculated values\r\n\r\n**Configuration Details:**\r\n\r\n- **Dynamic Properties:** \r\n  - Dynamic Document Property - DDP_CustomerName\r\n  - Dynamic Document Property - DDP_Subscription  \r\n  - Dynamic Document Property - DDP_SalesforceDescription\r\n  - Additional calculated properties (1 more)\r\n- **HTTP Calls:** External API calls to retrieve customer and product details\r\n- **Calculations:** Date calculations for opportunity close dates and string concatenations\r\n- **Parameter Mappings:** Source value configurations from webhook payload\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Raw Stripe webhook JSON data\r\n- **Processing:** Extract customer ID, retrieve customer details via API, calculate close dates, build descriptions\r\n- **Output:** Enhanced data with calculated properties ready for transformation\r\n\r\n---\r\n\r\n#### **Step 3: Transform/Map Components (shape4)**\r\n\r\n**Component Type:** Map/Transform\r\n\r\n**Purpose:** Transform Stripe subscription JSON data to Salesforce Opportunity XML format\r\n\r\n**Configuration Details:**\r\n\r\n- **Input Profile:** Subscription Completed JSON\r\n- **Output Profile:** SF Opportunity CREATE Request XML  \r\n- **Transformation Logic:** JSON to XML conversion with field mapping\r\n- **Function Steps:** DocumentPropertyGet functions to retrieve calculated values\r\n\r\n**Field Mappings:**\r\n\r\n| Source Field | Target Field | Data Type | Business Purpose |\r\n|--------------|--------------|-----------|------------------|\r\n| Function Output (DDP_SalesforceDescription) | Opportunity/Description | String | Maps calculated description to opportunity description field |\r\n| Function Output (DDP_CustomerName) | Opportunity/Name | String | Maps retrieved customer name to opportunity name field |\r\n| Function Output (DDP_CloseDate) | Opportunity/CloseDate | Date | Maps calculated close date to opportunity close date field |\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe subscription JSON with enhanced properties\r\n- **Processing:** Field-level mapping from JSON structure to Salesforce XML format\r\n- **Output:** Salesforce-compatible XML opportunity creation request\r\n\r\n---\r\n\r\n#### **Step 4: Connector Actions (shape3)**\r\n\r\n**Component Type:** Salesforce Connector\r\n\r\n**Purpose:** Create new opportunity records in Salesforce using the transformed data\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Salesforce\r\n- **Operation:** Create\r\n- **Target Object:** Opportunity\r\n- **Authentication:** OAuth 2.0 or SOAP session authentication\r\n- **Error Handling:** Exception handling for creation failures\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce opportunity XML creation request\r\n- **Processing:** Send create request to Salesforce API with authentication\r\n- **Output:** Salesforce response confirming opportunity creation success/failure\r\n\r\n---\r\n\r\n#### **Step 5: End Events (shape5)**\r\n\r\n**Component Type:** End Event\r\n\r\n**Purpose:** Complete the integration process and return response to Stripe webhook\r\n\r\n**Configuration Details:**\r\n\r\n- **Completion Type:** Success completion with optional response data\r\n- **Final Actions:** Log completion status and prepare webhook response\r\n- **Continuation Settings:** Process stops after successful completion\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce opportunity creation response\r\n- **Processing:** Log success/failure status and format response\r\n- **Output:** HTTP response to Stripe webhook confirming processing completion\r\n\r\n## Boomi Transformations Explained\r\n\r\n### Subscription Completed JSON to SF Opportunity CREATE Request XML\r\n\r\nThis transformation converts incoming Stripe subscription webhook JSON data into Salesforce-compatible XML format for opportunity creation. The transformation leverages dynamic document properties to enrich the basic subscription data with customer information and calculated business values.\r\n\r\n**Input Profile:** Subscription Completed JSON\r\n- Stripe webhook event structure containing subscription and customer identifiers\r\n- Product information from subscription line items\r\n- Event metadata and timestamps\r\n\r\n**Output Profile:** SF Opportunity CREATE Request XML  \r\n- Salesforce SOAP API opportunity creation structure\r\n- Required opportunity fields (Name, Description, CloseDate)\r\n- Proper XML namespace and element structure\r\n\r\n### Field Mappings\r\n\r\n| Source Field | Target Field | Data Type | Business Purpose |\r\n|--------------|--------------|-----------|------------------|\r\n| Function Output (DocumentPropertyGet - DDP_SalesforceDescription) | Opportunity/Description | String | Provides detailed opportunity description combining customer and subscription information |\r\n| Function Output (DocumentPropertyGet - DDP_CustomerName) | Opportunity/Name | String | Sets opportunity name using retrieved customer information from Stripe |\r\n| Function Output (DocumentPropertyGet - DDP_CloseDate) | Opportunity/CloseDate | Date | Establishes opportunity close date based on subscription timing calculations |\r\n\r\n### Transformation Functions\r\n\r\n**Get Document Property (ProcessProperty) - DDP_SalesforceDescription**\r\n- **Purpose:** Retrieves calculated description combining customer name, subscription details, and product information\r\n- **Output:** Dynamic Document Property - DDP_SalesforceDescription\r\n- **Business Logic:** Concatenates customer information with subscription details for meaningful opportunity descriptions\r\n\r\n**Get Document Property (ProcessProperty) - DDP_CustomerName**  \r\n- **Purpose:** Retrieves customer name from external API call based on customer ID from subscription\r\n- **Output:** Dynamic Document Property - DDP_CustomerName\r\n- **Business Logic:** Fetches customer details from Stripe API to populate opportunity name\r\n\r\n**Get Document Property (ProcessProperty) - DDP_CloseDate**\r\n- **Purpose:** Calculates appropriate opportunity close date based on subscription start date and business rules\r\n- **Output:** Dynamic Document Property - DDP_CloseDate  \r\n- **Business Logic:** Applies date calculations to determine realistic opportunity closure timeline\r\n\r\n## SAP Integration Suite Implementation\r\n\r\n### Component Mapping\r\n\r\n#### Main Process Component Mapping\r\n| Boomi Component | SAP Integration Suite Equivalent | Purpose |\r\n|-----------------|----------------------------------|---------|\r\n| Start Event (shape1) - Web Services Server | HTTPS Adapter (Sender) with Start Message Event | Receives incoming Stripe webhook HTTP requests |\r\n| Document Properties (shape6) | Content Modifier (Set Properties) | Calculates dynamic properties and enriches data |\r\n| Map Transform (shape4) | Message Mapping (JSON to XML) | Transforms Stripe JSON to Salesforce XML format |\r\n| Salesforce Connector (shape3) | Salesforce Adapter or HTTPS Adapter (Receiver) | Creates opportunities in Salesforce system |\r\n| End Event (shape5) | End Message Event | Completes the integration flow |\r\n\r\n### Integration Flow Visualization\r\n\r\n## Main Integration Flow Diagram\r\n\r\n```mermaid\r\nflowchart TD\r\n%% Define node styles for SAP Integration Suite components\r\nclassDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px\r\nclassDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px\r\nclassDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px\r\nclassDef adapter fill:#FFD700,stroke:#333,stroke-width:2px\r\nclassDef event fill:#C0C0C0,stroke:#333,stroke-width:2px\r\nclassDef errorHandler fill:#FFA07A,stroke:#333,stroke-width:2px\r\n\r\n%% Main Process Flow\r\nStart((\"Start: Stripe Webhook<br/>shape1\")) --> StripeWebhook[\"HTTPS Adapter: Receive Stripe<br/>Subscription Webhook\"]:::httpAdapter\r\nStripeWebhook --> SetDynamicProps[\"Content Modifier: Set Dynamic Properties<br/>shape6\"]:::contentModifier\r\nSetDynamicProps --> TransformData{\"Message Mapping: JSON to XML<br/>shape4\"}:::mapping\r\nTransformData --> SalesforceCreate[\"Salesforce Adapter: Create Opportunity<br/>shape3\"]:::adapter\r\nSalesforceCreate --> End((\"End: Process Complete<br/>shape5\")):::event\r\n\r\n%% Dynamic Properties Detail\r\nsubgraph DynamicProperties[\"Dynamic Properties Calculation (shape6)\"]\r\n    GetCustomer[\"HTTP GET: Retrieve Customer Details<br/>DDP_CustomerName\"]:::httpAdapter\r\n    GetProduct[\"HTTP GET: Retrieve Product Information<br/>DDP_Subscription\"]:::httpAdapter\r\n    BuildDescription[\"Calculate: Build Opportunity Description<br/>DDP_SalesforceDescription\"]:::contentModifier\r\n    CalcCloseDate[\"Calculate: Close Date + Business Rules<br/>DDP_CloseDate\"]:::contentModifier\r\nend\r\n\r\n%% Add styling based on component types\r\nclass StripeWebhook,GetCustomer,GetProduct httpAdapter\r\nclass SetDynamicProps,BuildDescription,CalcCloseDate contentModifier\r\nclass TransformData mapping\r\nclass SalesforceCreate adapter\r\nclass Start,End event\r\n```\r\n\r\n### Configuration Details\r\n\r\n**HTTPS Adapter (Stripe Webhook Receiver):**\r\n- **Address:** `/ws/simple/createSalesforceOpportunities`\r\n- **HTTP Method:** POST\r\n- **Content Type:** application/json\r\n- **Authentication:** Webhook signature validation\r\n- **Error Handling:** Return appropriate HTTP status codes\r\n\r\n**Content Modifier (Dynamic Properties):**\r\n- **DDP_CustomerName:** HTTP GET to Stripe API for customer details\r\n- **DDP_Subscription:** Extract subscription information from webhook payload\r\n- **DDP_SalesforceDescription:** Concatenate customer name with subscription details\r\n- **DDP_CloseDate:** Calculate close date based on subscription start date\r\n\r\n**Message Mapping (JSON to XML):**\r\n- **Source Schema:** Stripe subscription webhook JSON structure\r\n- **Target Schema:** Salesforce Opportunity XML creation format\r\n- **Mapping Functions:** DocumentPropertyGet for dynamic value retrieval\r\n- **Field Transformations:** Direct mapping with data type conversion\r\n\r\n**Salesforce Adapter (Opportunity Creation):**\r\n- **Operation:** CREATE\r\n- **Object:** Opportunity\r\n- **Authentication:** OAuth 2.0 or Session-based\r\n- **Required Fields:** Name, Description, CloseDate\r\n- **Error Handling:** Exception handling for creation failures\r\n\r\n## Environment Configuration\r\n\r\n**Integration Runtime Requirements:**\r\n- **Runtime Environment:** SAP Integration Suite Cloud or On-Premise\r\n- **Memory Requirements:** Minimum 2GB for webhook processing and API calls\r\n- **CPU Requirements:** Multi-core processing for concurrent webhook handling\r\n- **Network Requirements:** Outbound HTTPS connectivity to Stripe and Salesforce APIs\r\n- **Storage Requirements:** Minimal temporary storage for message processing\r\n\r\n**External System Dependencies:**\r\n- **Stripe API:** Customer and product information retrieval\r\n  - Base URL: `https://api.stripe.com/v1/`\r\n  - Authentication: Bearer token authentication\r\n  - Rate Limits: Standard Stripe API rate limiting applies\r\n- **Salesforce API:** Opportunity creation and management\r\n  - Base URL: `https://[instance].salesforce.com/services/data/v[version]/`\r\n  - Authentication: OAuth 2.0 or SOAP session\r\n  - Rate Limits: Salesforce API rate limiting applies\r\n\r\n**Security Configuration:**\r\n- **Webhook Security:** Stripe signature verification for webhook authenticity\r\n- **API Authentication:** Secure token management for external API calls\r\n- **Data Encryption:** TLS encryption for all external communications\r\n- **Access Control:** Role-based access for integration configuration\r\n- **Audit Logging:** Comprehensive logging for webhook processing and API calls\r\n\r\n**Configuration Parameters:**\r\n- **Stripe API Key:** Required for customer and product API calls\r\n- **Salesforce Credentials:** OAuth or session credentials for opportunity creation\r\n- **Webhook Endpoint URL:** Public URL for Stripe webhook delivery\r\n- **Close Date Calculation Rules:** Business rules for opportunity close date calculation\r\n- **Error Notification Settings:** Email or system notification configuration for failures\r\n\r\n## API Reference\r\n\r\n### Stripe Subscription Events\r\n\r\n**Webhook Event Types:**\r\n- `customer.subscription.created`: New subscription created\r\n- `customer.subscription.updated`: Subscription modified  \r\n- `customer.subscription.deleted`: Subscription cancelled\r\n\r\n**Webhook Payload Structure:**\r\n```json\r\n{\r\n  \"id\": \"evt_1234567890\",\r\n  \"object\": \"event\", \r\n  \"api_version\": \"2020-08-27\",\r\n  \"created\": 1234567890,\r\n  \"type\": \"customer.subscription.created\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"sub_1234567890\",\r\n      \"customer\": \"cus_1234567890\",\r\n      \"status\": \"active\",\r\n      \"items\": {\r\n        \"data\": [\r\n          {\r\n            \"id\": \"si_1234567890\",\r\n            \"price\": {\r\n              \"id\": \"price_1234567890\",\r\n              \"product\": \"prod_1234567890\"\r\n            }\r\n          }\r\n        ]\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n### Salesforce Opportunity API\r\n\r\n**Create Opportunity Request:**\r\n```xml\r\n<sObjects>\r\n  <Opportunity>\r\n    <Name>Customer Subscription Opportunity</Name>\r\n    <Description>Opportunity created from Stripe subscription</Description>\r\n    <CloseDate>2024-12-31</CloseDate>\r\n    <StageName>Prospecting</StageName>\r\n  </Opportunity>\r\n</sObjects>\r\n```\r\n\r\n**Response Codes:**\r\n- **200 OK:** Successful opportunity creation\r\n- **400 Bad Request:** Invalid opportunity data or missing required fields\r\n- **401 Unauthorized:** Authentication failure\r\n- **403 Forbidden:** Insufficient permissions\r\n- **500 Internal Server Error:** Salesforce processing error\r\n\r\n**Error Handling:**\r\n- Webhook signature validation failures return 401 Unauthorized\r\n- API rate limit exceeded returns 429 Too Many Requests\r\n- Salesforce field validation errors return detailed error messages\r\n- Network connectivity issues trigger retry logic with exponential backoff",
  "markdown_length": 19463,
  "constructed_query": "Create a complete SAP iFlow integration package named 'IFlow_a93feac2' with the following requirements from the documentation:\n\n# Create Salesforce Opportunities from Stripe Subscriptions Integration\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n   - [Stripe Webhook Endpoint](#stripe-webhook-endpoint)\r\n   - [Salesforce Opportunity Creation Endpoint](#salesforce-opportunity-creation-endpoint)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n   - [Subscription Completed JSON to SF Opportunity CREATE Request XML](#subscription-completed-json-to-sf-opportunity-create-request-xml)\r\n   - [Field Mappings](#field-mappings)\r\n   - [Transformation Functions](#transformation-functions)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n   - [Stripe Subscription Events](#stripe-subscription-events)\r\n   - [Salesforce Opportunity API](#salesforce-opportunity-api)\r\n\r\n## API Overview\r\n\r\nThis integration provides a real-time synchronization mechanism between Stripe subscription events and Salesforce opportunity creation. The integration is designed to automatically create Salesforce opportunities when specific Stripe subscription events occur, ensuring seamless data flow between the payment processing system and CRM.\r\n\r\n**Key Capabilities:**\r\n- Real-time webhook processing from Stripe subscription events\r\n- Dynamic property calculation and data enrichment\r\n- Automated Salesforce opportunity creation with proper field mapping\r\n- Error handling and logging for subscription processing failures\r\n\r\n**Base URL Pattern:**\r\n- Stripe Webhook Listener: `https://[boomi-runtime]/ws/\n\nGenerate a production-ready iFlow with proper:\n1. Start and End events\n2. Required adapters and connectors\n3. Content modifiers and processing steps\n4. Proper sequence flows\n5. Error handling\n6. SAP Integration Suite compliance\n",
  "query_length": 2358,
  "markdown_truncated_at": 2000,
  "api_endpoint": "/api/generate-iflow-from-markdown",
  "request_time": "2025-10-23T18:25:32.681076"
}