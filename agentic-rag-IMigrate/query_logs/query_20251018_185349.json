{
  "timestamp": "20251018_185349",
  "job_id": null,
  "iflow_name": "IFlow_47b1fef2",
  "original_markdown": "# Stripe Subscription to Salesforce Opportunity Integration API\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration facilitates the automatic creation of Salesforce Opportunities from Stripe subscription events. The system listens for Stripe webhook events related to subscription completions and transforms the subscription data into Salesforce Opportunity records, enabling seamless customer lifecycle management between payment processing and CRM systems.\r\n\r\n**Base URL Pattern:** Webhook-based event listener for Stripe subscription events\r\n**Authentication:** Stripe webhook signature verification and Salesforce OAuth\r\n**Rate Limiting:** Dependent on Stripe webhook frequency and Salesforce API limits\r\n**Response Format:** XML-based Salesforce SOAP API responses\r\n\r\n**Business Purpose:** \r\n- Automate opportunity creation from successful subscription events\r\n- Maintain synchronization between payment system and CRM\r\n- Enable sales team visibility into subscription-based revenue\r\n\r\n## Endpoints\r\n\r\n### Stripe Webhook Listener\r\n- **HTTP Method:** POST (Webhook receiver)\r\n- **Purpose:** Receives Stripe subscription completion webhook events\r\n- **Request Body:** Stripe webhook payload containing subscription data\r\n- **Response:** Acknowledgment of webhook receipt\r\n- **Error Handling:** Exception handling for malformed webhook data\r\n\r\n### Salesforce Opportunity Creation\r\n- **Target Object:** Salesforce Opportunity\r\n- **Operation:** CREATE\r\n- **Purpose:** Creates new opportunity records from subscription data\r\n- **Authentication:** Salesforce OAuth-based authentication\r\n- **Error Handling:** Salesforce API error responses and retry logic\r\n\r\n## Current Boomi Flow Logic\r\n\r\n### Process Flow Overview\r\n\r\nThis Boomi process creates a seamless integration between Stripe subscription events and Salesforce opportunity management. The integration follows an event-driven architecture where:\r\n\r\n1. **Webhook Reception:** Process is triggered by incoming Stripe subscription webhook events\r\n2. **Dynamic Property Calculation:** Extracts and processes subscription data to calculate opportunity attributes\r\n3. **Data Transformation:** Converts Stripe subscription JSON format to Salesforce Opportunity XML structure\r\n4. **Salesforce Integration:** Creates opportunity records in Salesforce using the transformed data\r\n5. **Error Handling:** Manages any processing failures with appropriate error responses\r\n\r\n### Step-by-Step Flow Description\r\n\r\n---\r\n\r\n#### **Step 1: Start Event (shape1)**\r\n\r\n**Component Type:** Start Event\r\n\r\n**Purpose:** Webhook listener that receives Stripe subscription completion events and initiates the opportunity creation process\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Webhook receiver (inbound HTTP endpoint)\r\n- **Operation:** Listen for incoming POST requests from Stripe\r\n- **Input Profile:** Stripe subscription webhook JSON payload\r\n- **Trigger Conditions:** Stripe subscription.created or subscription.updated events\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe webhook JSON payload containing subscription details, customer information, and payment data\r\n- **Processing:** Validates webhook signature and parses subscription event data\r\n- **Output:** Structured subscription data ready for property extraction and transformation\r\n\r\n---\r\n\r\n#### **Step 2: Document Properties (shape6)**\r\n\r\n**Component Type:** Document Properties - Set Dynamic Properties\r\n\r\n**Purpose:** Extracts key subscription data and calculates dynamic values needed for Salesforce opportunity creation\r\n\r\n**Configuration Details:**\r\n\r\n- **Dynamic Properties:** 4 dynamic document properties calculated from subscription data\r\n  - **Dynamic Document Property - DDP_CustomerName:** Process property: Dynamic Document Property - DDP_CustomerName\r\n  - **Dynamic Document Property - DDP_Subscription:** Process property: Dynamic Document Property - DDP_Subscription  \r\n  - **Dynamic Document Property - DDP_SalesforceDescription:** Process property: Dynamic Document Property - DDP_SalesforceDescription\r\n  - **Dynamic Document Property - DDP_CloseDate:** Calculated close date for opportunity (derived from subscription data)\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe subscription webhook payload from Step 1\r\n- **Processing:** Extracts customer name, subscription details, calculates opportunity description, and determines appropriate close date\r\n- **Output:** Enhanced data with calculated dynamic properties for opportunity creation\r\n\r\n---\r\n\r\n#### **Step 3: Transform/Map Component (shape4)**\r\n\r\n**Component Type:** Map/Transform - Subscription Completed JSON to SF Opportunity CREATE Request XML\r\n\r\n**Purpose:** Transforms Stripe subscription JSON data into Salesforce Opportunity XML format using dynamic properties\r\n\r\n**Configuration Details:**\r\n\r\n- **Input Profile:** Stripe subscription JSON webhook payload\r\n- **Output Profile:** Salesforce Opportunity CREATE Request XML structure\r\n- **Transformation Logic:** Maps subscription data to opportunity fields with dynamic property injection\r\n- **Function Steps:** DocumentPropertyGet functions to retrieve calculated dynamic values\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe subscription data with calculated dynamic properties\r\n- **Processing:** Field-by-field mapping from subscription attributes to Salesforce opportunity structure\r\n- **Output:** Complete Salesforce Opportunity XML ready for API submission\r\n\r\n---\r\n\r\n#### **Step 4: Connector Action (shape3)**\r\n\r\n**Component Type:** Salesforce Connector - SF Opportunity CREATE Operation\r\n\r\n**Purpose:** Creates the opportunity record in Salesforce using the transformed XML data\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Salesforce\r\n- **Operation:** CREATE\r\n- **Target Object:** Opportunity\r\n- **Authentication:** Salesforce OAuth authentication\r\n- **Error Handling:** Salesforce API error response processing\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce Opportunity XML from transformation step\r\n- **Processing:** Executes CREATE operation against Salesforce Opportunity object\r\n- **Output:** Salesforce response with created opportunity ID or error details\r\n\r\n---\r\n\r\n#### **Step 5: End Event (shape5)**\r\n\r\n**Component Type:** End Event\r\n\r\n**Purpose:** Completes the integration process and returns appropriate response to Stripe webhook\r\n\r\n**Configuration Details:**\r\n\r\n- **Completion Type:** Success completion with webhook acknowledgment\r\n- **Final Actions:** Process completion logging and webhook response\r\n- **Response Handling:** Returns HTTP 200 status to Stripe for successful processing\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce operation result from Step 4\r\n- **Processing:** Generates appropriate webhook response based on Salesforce operation outcome\r\n- **Output:** HTTP response to Stripe confirming successful opportunity creation\r\n\r\n## Boomi Transformations Explained\r\n\r\n### Subscription Completed JSON to SF Opportunity CREATE Request XML\r\n\r\n**Purpose:** This transformation converts Stripe subscription webhook data (JSON format) into the XML structure required for Salesforce Opportunity creation via SOAP API.\r\n\r\n**Input Profile Format:** Stripe webhook JSON payload containing subscription, customer, and payment information\r\n**Output Profile Format:** Salesforce Opportunity XML structure with required fields for CREATE operation\r\n\r\n#### Detailed Field Mappings\r\n\r\n**Field Mappings:**\r\n\r\n| Source Field | Target Field | Data Type | Business Purpose |\r\n|--------------|--------------|-----------|------------------|\r\n| Dynamic Document Property - DDP_SalesforceDescription | Opportunity/Description | String | Maps calculated opportunity description from subscription details |\r\n| Dynamic Document Property - DDP_CustomerName | Opportunity/Name | String | Maps customer name as opportunity name for identification |\r\n| Dynamic Document Property - DDP_CloseDate | Opportunity/CloseDate | Date | Maps calculated close date for opportunity timeline management |\r\n\r\n#### Transformation Functions\r\n\r\n**Get Document Property Functions:**\r\n\r\n1. **Get Document Property (DDP_SalesforceDescription)**\r\n   - **Purpose:** Retrieves calculated opportunity description from document properties\r\n   - **Output:** Formatted description text for Salesforce opportunity record\r\n\r\n2. **Get Document Property (DDP_CustomerName)** \r\n   - **Purpose:** Retrieves customer name from document properties\r\n   - **Output:** Customer name string for opportunity identification\r\n\r\n3. **Get Document Property (DDP_CloseDate)**\r\n   - **Purpose:** Retrieves calculated close date from document properties  \r\n   - **Output:** Formatted date for opportunity close date field\r\n\r\n**Input Profile:** Stripe Subscription Webhook JSON\r\n- Subscription ID: Unique identifier for the subscription\r\n- Customer information: Name, email, billing details\r\n- Plan details: Product name, pricing, billing cycle\r\n- Payment information: Amount, currency, payment method\r\n\r\n**Output Profile:** Salesforce Opportunity CREATE XML\r\n- Name: Opportunity identification (customer-based)\r\n- Description: Detailed opportunity description\r\n- CloseDate: Projected close date for the opportunity\r\n- StageName: Initial stage for new opportunities\r\n- Amount: Opportunity value from subscription\r\n\r\n## SAP Integration Suite Implementation\r\n\r\n### Component Mapping\r\n\r\n#### Main Process Component Mapping\r\n| Boomi Component | SAP Integration Suite Equivalent | Purpose |\r\n|-----------------|----------------------------------|---------|\r\n| Start Event (shape1) | Start Message Event with HTTPS Adapter (Sender) | Webhook listener for Stripe subscription events |\r\n| Document Properties (shape6) | Content Modifier (Set Properties) | Calculate dynamic properties from subscription data |\r\n| Transform/Map (shape4) | Message Mapping | Transform JSON subscription data to Salesforce XML format |\r\n| Salesforce Connector (shape3) | HTTPS Adapter (Receiver) or Salesforce Adapter | Create opportunity records in Salesforce |\r\n| End Event (shape5) | End Message Event | Complete process execution and return response |\r\n\r\n### Integration Flow Visualization\r\n\r\n```mermaid\r\nflowchart TD\r\n    %% Define node styles for SAP Integration Suite components\r\n    classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px\r\n    classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px\r\n    classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px\r\n    classDef adapter fill:#FFD700,stroke:#333,stroke-width:2px\r\n    classDef event fill:#C0C0C0,stroke:#333,stroke-width:2px\r\n    classDef errorHandler fill:#FFA07A,stroke:#333,stroke-width:2px\r\n\r\n    %% Main Integration Flow\r\n    Start((Start Message Event)) --> StripeWebhook[\"HTTPS Adapter: Stripe Webhook Listener\"]:::httpAdapter\r\n    StripeWebhook --> SetDynamicProps[\"Content Modifier: Set Dynamic Properties\"]:::contentModifier\r\n    SetDynamicProps --> TransformData[\"Message Mapping: JSON to Salesforce XML\"]:::mapping\r\n    TransformData --> SalesforceCreate[\"Salesforce Adapter: Create Opportunity\"]:::adapter\r\n    SalesforceCreate --> End((End Message Event)):::event\r\n\r\n    %% Dynamic Properties Detail\r\n    subgraph DynamicProperties[\"Dynamic Properties Calculation\"]\r\n        ExtractCustomer[\"Extract: Customer Name from Subscription\"]:::contentModifier\r\n        ExtractSubscription[\"Extract: Subscription Details\"]:::contentModifier\r\n        CalcDescription[\"Calculate: Opportunity Description\"]:::contentModifier\r\n        CalcCloseDate[\"Calculate: Close Date from Subscription Term\"]:::contentModifier\r\n    end\r\n\r\n    SetDynamicProps --> DynamicProperties\r\n    DynamicProperties --> TransformData\r\n\r\n    %% Error Handling Path\r\n    StripeWebhook -->|\"Webhook Validation Error\"| ErrorHandler[(Exception Subprocess)]:::errorHandler\r\n    TransformData -->|\"Transformation Error\"| ErrorHandler\r\n    SalesforceCreate -->|\"Salesforce API Error\"| ErrorHandler\r\n    ErrorHandler --> LogError[\"Write to Log: Error Details\"]:::contentModifier\r\n    LogError --> ErrorResponse[\"HTTP Response: Error Status\"]:::httpAdapter\r\n    ErrorResponse --> ErrorEnd((Error End Event)):::event\r\n```\r\n\r\n### Configuration Details\r\n\r\n#### HTTPS Adapter Configuration (Stripe Webhook)\r\n- **Connection Type:** HTTPS\r\n- **Address Pattern:** /stripe-webhook/subscription-completed\r\n- **HTTP Method:** POST\r\n- **Authentication:** Stripe webhook signature verification\r\n- **Content Type:** application/json\r\n\r\n#### Content Modifier Configuration\r\n- **Property Name:** DDP_CustomerName\r\n- **Property Type:** Dynamic\r\n- **Source Expression:** Extract customer name from webhook payload\r\n- **Property Name:** DDP_SalesforceDescription  \r\n- **Property Type:** Dynamic\r\n- **Source Expression:** Concatenate subscription details for opportunity description\r\n\r\n#### Message Mapping Configuration\r\n- **Source Message Type:** Stripe Webhook JSON\r\n- **Target Message Type:** Salesforce Opportunity XML\r\n- **Mapping Rules:** Field-level mappings with dynamic property injection\r\n- **Function Library:** Standard SAP CPI function library for data transformation\r\n\r\n#### Salesforce Adapter Configuration\r\n- **Connection Type:** Salesforce\r\n- **Operation:** CREATE\r\n- **Object Type:** Opportunity\r\n- **Authentication:** OAuth 2.0\r\n- **API Version:** Latest supported version\r\n- **Bulk Processing:** Disabled (single record processing)\r\n\r\n## Environment Configuration\r\n\r\n### Required Configuration Parameters\r\n- **Stripe Webhook Secret:** Environment-specific webhook signature validation key\r\n- **Salesforce OAuth Credentials:** Client ID, Client Secret, Username, Password for Salesforce authentication\r\n- **Opportunity Default Values:** Default stage name, record type, and other required Salesforce fields\r\n- **Close Date Calculation:** Business logic for determining opportunity close dates from subscription terms\r\n\r\n### Environment Variables\r\n| Variable Name | Description | Example Value |\r\n|---------------|-------------|---------------|\r\n| `STRIPE_WEBHOOK_SECRET` | Stripe webhook signature validation secret | `whsec_1234567890abcdef` |\r\n| `SALESFORCE_CLIENT_ID` | Salesforce connected app client ID | `3MVG9Y6d_Btp4xp_abc123` |\r\n| `SALESFORCE_CLIENT_SECRET` | Salesforce connected app client secret | `1234567890123456789` |\r\n| `SALESFORCE_USERNAME` | Salesforce integration user username | `integration@company.com` |\r\n| `SALESFORCE_PASSWORD` | Salesforce integration user password + security token | `password123ABCD` |\r\n| `DEFAULT_OPPORTUNITY_STAGE` | Default stage for new opportunities | `Prospecting` |\r\n| `CLOSE_DATE_OFFSET_DAYS` | Days to add to current date for close date | `90` |\r\n\r\n### Dependencies on External Systems\r\n- **Stripe Platform:** Webhook event source for subscription data\r\n- **Salesforce CRM:** Target system for opportunity creation\r\n- **Certificate Management:** SSL certificates for secure API communications\r\n\r\n### Security Settings\r\n- **Webhook Signature Verification:** Stripe webhook signature validation using shared secret\r\n- **OAuth 2.0 Authentication:** Salesforce API authentication with refresh token management\r\n- **TLS/SSL Encryption:** All API communications encrypted in transit\r\n- **IP Whitelisting:** Restrict access to known Stripe webhook IP ranges\r\n\r\n### Deployment Considerations\r\n- **High Availability:** Deploy across multiple availability zones for redundancy\r\n- **Scalability:** Configure auto-scaling for high-volume subscription events\r\n- **Monitoring:** Implement comprehensive logging and monitoring for webhook processing\r\n- **Error Recovery:** Configure retry mechanisms for transient failures\r\n\r\n### Required Resources\r\n- **Memory:** Minimum 2GB RAM for JSON/XML processing\r\n- **CPU:** Dual-core minimum for transformation operations  \r\n- **Storage:** 10GB for temporary file processing and logs\r\n- **Network:** Reliable internet connectivity for Stripe and Salesforce APIs\r\n\r\n## API Reference\r\n\r\n### Stripe Webhook Endpoint\r\n\r\n#### POST /stripe-webhook/subscription-completed\r\n**Purpose:** Receives Stripe subscription webhook events for opportunity creation\r\n\r\n**Request Headers:**\r\n| Header | Required | Description | Example Value |\r\n|--------|----------|-------------|---------------|\r\n| `Stripe-Signature` | Yes | Webhook signature for verification | `t=1234567890,v1=abc123def456` |\r\n| `Content-Type` | Yes | Request content type | `application/json` |\r\n\r\n**Request Body Schema:**\r\n```json\r\n{\r\n  \"id\": \"evt_subscription_created\",\r\n  \"type\": \"customer.subscription.created\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"sub_1234567890\",\r\n      \"customer\": \"cus_customer123\",\r\n      \"plan\": {\r\n        \"id\": \"plan_premium\",\r\n        \"name\": \"Premium Plan\",\r\n        \"amount\": 9900,\r\n        \"currency\": \"usd\"\r\n      },\r\n      \"status\": \"active\",\r\n      \"current_period_start\": 1640995200,\r\n      \"current_period_end\": 1643673600\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Response Codes:**\r\n- `200 OK`: Webhook processed successfully, opportunity created\r\n- `400 Bad Request`: Invalid webhook signature or malformed payload\r\n- `500 Internal Server Error`: Processing error, opportunity creation failed\r\n\r\n### Salesforce Opportunity Creation\r\n\r\n#### Salesforce SOAP API - CREATE Operation\r\n**Target Object:** Opportunity\r\n**Operation Type:** CREATE\r\n\r\n**Request XML Schema:**\r\n```xml\r\n<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:urn=\"urn:enterprise.soap.sforce.com\">\r\n   <soapenv:Header>\r\n      <urn:SessionHeader>\r\n         <urn:sessionId>SESSION_ID</urn:sessionId>\r\n      </urn:SessionHeader>\r\n   </soapenv:Header>\r\n   <soapenv:Body>\r\n      <urn:create>\r\n         <urn:sObjects xsi:type=\"Opportunity\">\r\n            <Name>Customer Name - Subscription</Name>\r\n            <Description>Subscription details and customer information</Description>\r\n            <CloseDate>2024-03-31</CloseDate>\r\n            <StageName>Prospecting</StageName>\r\n            <Amount>99.00</Amount>\r\n         </urn:sObjects>\r\n      </urn:create>\r\n   </soapenv:Body>\r\n</soapenv:Envelope>\r\n```\r\n\r\n**Response Schema:**\r\n```xml\r\n<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\">\r\n   <soapenv:Body>\r\n      <createResponse>\r\n         <result>\r\n            <id>006XX0000012345</id>\r\n            <success>true</success>\r\n         </result>\r\n      </createResponse>\r\n   </soapenv:Body>\r\n</soapenv:Envelope>\r\n```\r\n\r\n### Error Codes and Meanings\r\n| Error Code | Description | Resolution |\r\n|------------|-------------|------------|\r\n| `STRIPE_001` | Invalid webhook signature | Verify Stripe webhook secret configuration |\r\n| `STRIPE_002` | Malformed webhook payload | Check Stripe webhook configuration |\r\n| `SF_001` | Salesforce authentication failure | Verify OAuth credentials |\r\n| `SF_002` | Required field missing | Check opportunity field mappings |\r\n| `SF_003` | Duplicate opportunity detected | Implement duplicate detection logic |\r\n| `TRANSFORM_001` | JSON to XML transformation error | Verify field mapping configuration |\r\n\r\n### Rate Limiting\r\n- **Stripe Webhooks:** No explicit rate limiting, based on subscription event frequency\r\n- **Salesforce API:** Standard Salesforce API limits apply (24-hour rolling period)\r\n- **Recommended Processing:** Implement exponential backoff for Salesforce API failures\r\n\r\n### Authentication Requirements\r\n- **Stripe:** Webhook signature verification using HMAC-SHA256\r\n- **Salesforce:** OAuth 2.0 with refresh token management\r\n- **Certificate Validation:** SSL certificate validation for all HTTPS connections",
  "markdown_length": 20044,
  "constructed_query": "Create a complete SAP iFlow integration package named 'IFlow_47b1fef2' with the following requirements from the documentation:\n\n# Stripe Subscription to Salesforce Opportunity Integration API\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration facilitates the automatic creation of Salesforce Opportunities from Stripe subscription events. The system listens for Stripe webhook events related to subscription completions and transforms the subscription data into Salesforce Opportunity records, enabling seamless customer lifecycle management between payment processing and CRM systems.\r\n\r\n**Base URL Pattern:** Webhook-based event listener for Stripe subscription events\r\n**Authentication:** Stripe webhook signature verification and Salesforce OAuth\r\n**Rate Limiting:** Dependent on Stripe webhook frequency and Salesforce API limits\r\n**Response Format:** XML-based Salesforce SOAP API responses\r\n\r\n**Business Purpose:** \r\n- Automate opportunity creation from successful subscription events\r\n- Maintain synchronization between payment system and CRM\r\n- Enable sales team visibility into subscription-based revenue\r\n\r\n## Endpoints\r\n\r\n### Stripe Webhook Listener\r\n- **HTTP Method:** POST (Webhook receiver)\r\n- **Purpose:** Receives Stripe subscription completion webhook events\r\n- **Request Body:** Stripe webhook payload containing subscription data\r\n- **Response:** Acknowledgment of webhook receipt\r\n- **Error Handling:** Exception handling for m\n\nGenerate a production-ready iFlow with proper:\n1. Start and End events\n2. Required adapters and connectors\n3. Content modifiers and processing steps\n4. Proper sequence flows\n5. Error handling\n6. SAP Integration Suite compliance\n",
  "query_length": 2358,
  "markdown_truncated_at": 2000,
  "api_endpoint": "/api/generate-iflow-from-markdown",
  "request_time": "2025-10-18T18:53:49.735536"
}