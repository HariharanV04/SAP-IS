{
  "timestamp": "20251017_212349",
  "job_id": "5f1c5c58-bf32-4785-9b33-6cd35b6055bc",
  "iflow_name": "IFlow_2e3d400e",
  "original_markdown": "# Stripe Subscription to Salesforce Opportunity Integration API\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n     - [Step 1: Start Event (shape1)](#step-1-start-event-shape1)\r\n     - [Step 2: Document Properties (shape6)](#step-2-document-properties-shape6)\r\n     - [Step 3: Transform/Map Component (shape4)](#step-3-transformmap-component-shape4)\r\n     - [Step 4: Connector Actions (shape3)](#step-4-connector-actions-shape3)\r\n     - [Step 5: End Event (shape5)](#step-5-end-event-shape5)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration process automates the creation of Salesforce Opportunities based on completed Stripe subscriptions. The API serves as a webhook receiver that processes Stripe subscription completion events and transforms them into structured Salesforce Opportunity records. This enables seamless revenue tracking and sales pipeline management by connecting payment processing with CRM operations.\r\n\r\n**Key Features:**\r\n- Real-time webhook processing of Stripe subscription events\r\n- Dynamic property calculation for customer and subscription details\r\n- Automated Salesforce opportunity creation with proper field mappings\r\n- Error handling and logging capabilities\r\n\r\n**Business Purpose:**\r\n- Automatically create sales opportunities when customers complete subscription purchases\r\n- Maintain accurate revenue pipeline tracking across payment and CRM systems\r\n- Reduce manual data entry and improve data consistency\r\n- Enable real-time visibility into subscription-based revenue\r\n\r\n**Authentication:** \r\n- Webhook-based authentication for Stripe events\r\n- Salesforce OAuth 2.0 for CRM operations\r\n\r\n**Response Format:** XML-based Salesforce API responses\r\n\r\n## Endpoints\r\n\r\n### Webhook Receiver Endpoint\r\n- **HTTP Method:** POST (inferred from webhook pattern)\r\n- **Purpose:** Receives Stripe subscription completion webhook events\r\n- **Request Format:** JSON payload from Stripe webhook\r\n- **Response Format:** Success/failure acknowledgment\r\n- **Authentication:** Webhook signature validation (Stripe standard)\r\n\r\n**Request Structure:**\r\n```json\r\n{\r\n  \"type\": \"subscription.completed\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"sub_xxxxx\",\r\n      \"customer\": \"cus_xxxxx\",\r\n      \"status\": \"active\",\r\n      \"current_period_end\": 1234567890,\r\n      \"items\": {...}\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Response Codes:**\r\n- 200: Webhook processed successfully\r\n- 400: Invalid webhook payload\r\n- 401: Authentication failure\r\n- 500: Processing error\r\n\r\n## Current Boomi Flow Logic\r\n\r\n### Process Flow Overview\r\n\r\nThis Boomi process implements a webhook-to-CRM integration pattern that:\r\n1. Receives Stripe subscription completion webhook events through a start listener\r\n2. Calculates dynamic properties for customer name, subscription details, and close dates\r\n3. Transforms JSON webhook data into Salesforce XML format for opportunity creation\r\n4. Creates new opportunities in Salesforce using the native Salesforce connector\r\n5. Completes the process with success confirmation\r\n\r\nThe integration follows event-driven architecture principles, processing subscription events in real-time to maintain accurate sales pipeline data.\r\n\r\n### Step-by-Step Flow Description\r\n\r\n---\r\n\r\n#### **Step 1: Start Event (shape1)**\r\n\r\n**Component Type:** Start Event\r\n\r\n**Purpose:** Initiates the integration process when Stripe webhook events are received\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Webhook Listener (inferred from integration pattern)\r\n- **Operation:** Listen for incoming HTTP POST requests\r\n- **Input Profile:** JSON webhook payload from Stripe\r\n- **Trigger Conditions:** Stripe subscription completion events\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Stripe webhook JSON payload containing subscription completion data\r\n- **Processing:** Event validation and initial data capture\r\n- **Output:** Validated webhook data ready for property calculation\r\n\r\n---\r\n\r\n#### **Step 2: Document Properties (shape6)**\r\n\r\n**Component Type:** Document Properties\r\n\r\n**Purpose:** Calculates and sets dynamic properties for customer details, subscription information, and Salesforce-specific data\r\n\r\n**Configuration Details:**\r\n\r\n- **Dynamic Properties:** 4 calculated properties\r\n  - Dynamic Document Property - DDP_CustomerName: Process property: Dynamic Document Property - DDP_CustomerName\r\n  - Dynamic Document Property - DDP_Subscription: Process property: Dynamic Document Property - DDP_Subscription  \r\n  - Dynamic Document Property - DDP_SalesforceDescription: Process property: Dynamic Document Property - DDP_SalesforceDescription\r\n  - Dynamic Document Property - DDP_CloseDate: Process property: Dynamic Document Property - DDP_CloseDate\r\n- **Calculations:** Customer name extraction, subscription details compilation, description formatting, and close date calculation\r\n- **Parameter Mappings:** Properties derived from incoming Stripe webhook data\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Raw Stripe webhook JSON data\r\n- **Processing:** Dynamic property calculation and data enhancement with business logic\r\n- **Output:** Enhanced data with calculated properties ready for transformation\r\n\r\n---\r\n\r\n#### **Step 3: Transform/Map Component (shape4)**\r\n\r\n**Component Type:** Map/Transform\r\n\r\n**Purpose:** Transforms Stripe subscription JSON data into Salesforce Opportunity XML format\r\n\r\n**Configuration Details:**\r\n\r\n- **Input Profile:** Subscription Completed JSON (Stripe webhook format)\r\n- **Output Profile:** SF Opportunity CREATE Request XML (Salesforce API format)\r\n- **Transformation Logic:** JSON to XML conversion with field mappings\r\n- **Function Steps:** DocumentPropertyGet functions for dynamic property retrieval\r\n\r\n**Field Mappings:**\r\n\r\n| Source Field | Target Field | Data Type | Business Purpose |\r\n|--------------|--------------|-----------|------------------|\r\n| Function Output (DDP_SalesforceDescription) | Opportunity/Description | String | Maps calculated description to Salesforce opportunity description |\r\n| Function Output (DDP_CustomerName) | Opportunity/Name | String | Maps customer name to Salesforce opportunity name |\r\n| Function Output (DDP_CloseDate) | Opportunity/CloseDate | Date | Maps calculated close date to Salesforce opportunity close date |\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** JSON webhook data with calculated dynamic properties\r\n- **Processing:** Field mapping and format conversion from JSON to Salesforce XML\r\n- **Output:** Properly formatted Salesforce opportunity creation XML request\r\n\r\n---\r\n\r\n#### **Step 4: Connector Actions (shape3)**\r\n\r\n**Component Type:** Salesforce Connector\r\n\r\n**Purpose:** Creates new opportunity records in Salesforce CRM system\r\n\r\n**Configuration Details:**\r\n\r\n- **Connector Type:** Salesforce\r\n- **Operation:** Create\r\n- **Target Object:** Opportunity\r\n- **Authentication:** OAuth 2.0 (Salesforce standard)\r\n- **Error Handling:** Standard Salesforce API error responses\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Formatted XML request for Salesforce opportunity creation\r\n- **Processing:** Salesforce API call to create opportunity record\r\n- **Output:** Salesforce response confirming opportunity creation or error details\r\n\r\n---\r\n\r\n#### **Step 5: End Event (shape5)**\r\n\r\n**Component Type:** End Event\r\n\r\n**Purpose:** Completes the integration process and confirms successful opportunity creation\r\n\r\n**Configuration Details:**\r\n\r\n- **Completion Type:** Success completion\r\n- **Final Actions:** Process completion confirmation\r\n- **Continuation Settings:** Process terminates after successful completion\r\n\r\n**Data Flow:**\r\n\r\n- **Input:** Salesforce API response from opportunity creation\r\n- **Processing:** Success validation and process completion\r\n- **Output:** Integration completion status and final results\r\n\r\n---\r\n\r\n## Boomi Transformations Explained\r\n\r\n### Subscription Completed JSON to SF Opportunity CREATE Request XML\r\n\r\n**Purpose:** This transformation converts Stripe webhook JSON data into the XML format required by Salesforce for creating opportunity records.\r\n\r\n**Input Profile:** Subscription Completed JSON\r\n- Stripe webhook payload containing subscription details, customer information, and payment data in JSON format\r\n\r\n**Output Profile:** SF Opportunity CREATE Request XML  \r\n- Salesforce API-compliant XML structure for opportunity creation with required fields\r\n\r\n**Transformation Functions:**\r\n\r\n**Get Document Property (ProcessProperty) - DDP_SalesforceDescription**\r\n- **Purpose:** Retrieves calculated Salesforce description from dynamic properties\r\n- **Function Type:** DocumentPropertyGet\r\n- **Output:** Formatted description text for opportunity record\r\n\r\n**Get Document Property (ProcessProperty) - DDP_CustomerName**\r\n- **Purpose:** Retrieves customer name from dynamic properties  \r\n- **Function Type:** DocumentPropertyGet\r\n- **Output:** Customer name for opportunity identification\r\n\r\n**Get Document Property (ProcessProperty) - DDP_CloseDate**\r\n- **Purpose:** Retrieves calculated close date from dynamic properties\r\n- **Function Type:** DocumentPropertyGet  \r\n- **Output:** Projected close date for sales pipeline tracking\r\n\r\n**Field Mappings:**\r\n\r\n| Source Field | Target Field | Data Type | Business Purpose |\r\n|--------------|--------------|-----------|------------------|\r\n| Function Output (DDP_SalesforceDescription) | Opportunity/Description | String | Maps calculated subscription details to opportunity description field |\r\n| Function Output (DDP_CustomerName) | Opportunity/Name | String | Maps customer identity to opportunity name for easy identification |\r\n| Function Output (DDP_CloseDate) | Opportunity/CloseDate | Date | Maps calculated close date to opportunity timeline for pipeline management |\r\n\r\n**Transformation Logic:**\r\n- Extracts dynamic properties calculated from Stripe subscription data\r\n- Maps function outputs to corresponding Salesforce opportunity fields\r\n- Converts data types from JSON string format to appropriate XML schema types\r\n- Maintains referential integrity between Stripe subscription and Salesforce opportunity\r\n\r\n## SAP Integration Suite Implementation\r\n\r\n### Component Mapping\r\n\r\n#### Main Process Component Mapping\r\n| Boomi Component | SAP Integration Suite Equivalent | Purpose |\r\n|-----------------|----------------------------------|---------|\r\n| Start Event (shape1) | Start Message Event | Initiates integration flow when webhook events are received |\r\n| Document Properties (shape6) | Content Modifier (Set Properties) | Calculates dynamic properties for customer and subscription data |\r\n| Map/Transform (shape4) | Message Mapping | Transforms JSON webhook data to Salesforce XML format |\r\n| Salesforce Connector (shape3) | Salesforce Adapter | Creates opportunity records in Salesforce CRM |\r\n| End Event (shape5) | End Message Event | Completes the integration process successfully |\r\n\r\n### Integration Flow Visualization\r\n\r\n```mermaid\r\nflowchart TD\r\n    %% Define node styles for SAP Integration Suite components\r\n    classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px\r\n    classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px\r\n    classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px\r\n    classDef adapter fill:#FFD700,stroke:#333,stroke-width:2px\r\n    classDef event fill:#C0C0C0,stroke:#333,stroke-width:2px\r\n\r\n    %% Main Integration Flow\r\n    Start((\"Start: Stripe Webhook\")) --> WebhookReceiver[\"HTTPS Adapter: Stripe Webhook Receiver\"]:::httpAdapter\r\n    WebhookReceiver --> SetDynamicProps[\"Content Modifier: Calculate Dynamic Properties\"]:::contentModifier\r\n    SetDynamicProps --> TransformData[\"Message Mapping: JSON to XML Transform\"]:::mapping\r\n    TransformData --> SalesforceCreate[\"Salesforce Adapter: Create Opportunity\"]:::adapter\r\n    SalesforceCreate --> End((\"End: Success\")):::event\r\n\r\n    %% Dynamic Properties Detail\r\n    subgraph DynamicProperties[\"Dynamic Properties Calculation\"]\r\n        ExtractCustomer[\"Extract: Customer Name from Webhook\"]:::contentModifier\r\n        ExtractSubscription[\"Extract: Subscription Details\"]:::contentModifier\r\n        CalcDescription[\"Calculate: Salesforce Description\"]:::contentModifier\r\n        CalcCloseDate[\"Calculate: Close Date\"]:::contentModifier\r\n    end\r\n\r\n    %% Apply styles to all components\r\n    class WebhookReceiver httpAdapter\r\n    class SetDynamicProps,ExtractCustomer,ExtractSubscription,CalcDescription,CalcCloseDate contentModifier\r\n    class TransformData mapping\r\n    class SalesforceCreate adapter\r\n    class Start,End event\r\n```\r\n\r\n### Configuration Details\r\n\r\n**HTTPS Adapter Configuration (Webhook Receiver):**\r\n- **Connection Type:** HTTPS Sender Adapter\r\n- **Address:** `/stripe/webhook` (configurable endpoint)\r\n- **Method:** POST\r\n- **Content Type:** application/json\r\n- **Authentication:** None (webhook signature validation in script)\r\n\r\n**Content Modifier Configuration (Dynamic Properties):**\r\n- **Property Name:** DDP_CustomerName\r\n- **Type:** XPath\r\n- **Data Type:** String\r\n- **Source Value:** Extracted from webhook customer object\r\n\r\n**Message Mapping Configuration:**\r\n- **Source Message Type:** Stripe Webhook JSON Schema\r\n- **Target Message Type:** Salesforce Opportunity XML Schema  \r\n- **Mapping Functions:** Constant values, property lookups, data type conversions\r\n\r\n**Salesforce Adapter Configuration:**\r\n- **Connection Type:** Salesforce Receiver Adapter\r\n- **Operation:** Create\r\n- **Object Type:** Opportunity\r\n- **Authentication:** OAuth 2.0\r\n- **Endpoint:** Salesforce production or sandbox URL\r\n\r\n## Environment Configuration\r\n\r\n**Important Configuration Parameters:**\r\n- Stripe webhook endpoint URL configuration\r\n- Salesforce connection credentials (OAuth client ID, secret, instance URL)\r\n- Dynamic property calculation logic for customer name extraction\r\n- Close date calculation business rules (subscription period + buffer)\r\n- Opportunity field mapping configurations\r\n\r\n**Environment Variables:**\r\n- `STRIPE_WEBHOOK_SECRET`: Webhook signature validation secret\r\n- `SALESFORCE_CLIENT_ID`: OAuth application client identifier  \r\n- `SALESFORCE_CLIENT_SECRET`: OAuth application client secret\r\n- `SALESFORCE_INSTANCE_URL`: Target Salesforce org URL (e.g., https://myorg.salesforce.com)\r\n- `SALESFORCE_USERNAME`: Service account username for API access\r\n- `SALESFORCE_PASSWORD`: Service account password for API access\r\n\r\n**Dependencies on External Systems:**\r\n- **Stripe Platform:** Webhook delivery for subscription completion events\r\n- **Salesforce CRM:** Opportunity object access and creation permissions\r\n- **Network Connectivity:** HTTPS access to both Stripe and Salesforce APIs\r\n\r\n**Security Settings:**\r\n- TLS 1.2+ for all external communications\r\n- OAuth 2.0 token management for Salesforce authentication\r\n- Webhook signature validation for Stripe event authenticity\r\n- Service account with minimal required Salesforce permissions\r\n\r\n**Deployment Considerations:**\r\n- High availability configuration for webhook processing\r\n- Retry logic for failed Salesforce API calls\r\n- Monitoring and alerting for integration failures\r\n- Log retention for audit and troubleshooting purposes\r\n\r\n**Required Resources:**\r\n- **Memory:** 2GB minimum for JSON/XML processing\r\n- **CPU:** Dual-core for concurrent webhook processing\r\n- **Storage:** 100MB for temporary file processing and logs\r\n- **Network:** Reliable outbound HTTPS connectivity\r\n\r\n## API Reference\r\n\r\n### Webhook Processing Endpoints\r\n\r\n#### Stripe Subscription Webhook Receiver\r\n- **Method:** POST\r\n- **Path:** `/webhook/stripe/subscription`\r\n- **Content-Type:** application/json\r\n- **Authentication:** Webhook signature validation\r\n\r\n**Request Schema:**\r\n```json\r\n{\r\n  \"id\": \"evt_xxxxxx\",\r\n  \"object\": \"event\", \r\n  \"type\": \"customer.subscription.created\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"sub_xxxxxx\",\r\n      \"customer\": \"cus_xxxxxx\",\r\n      \"status\": \"active\",\r\n      \"current_period_end\": 1640995200\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Response Schema:**\r\n```json\r\n{\r\n  \"received\": true,\r\n  \"processed\": true,\r\n  \"salesforce_opportunity_id\": \"006XXXXXXXXXXXXXXX\"\r\n}\r\n```\r\n\r\n### Salesforce Integration Endpoints\r\n\r\n#### Create Opportunity Operation\r\n- **Object:** Opportunity\r\n- **Operation:** CREATE\r\n- **Authentication:** OAuth 2.0\r\n\r\n**Request Fields:**\r\n- **Name:** Customer name from subscription\r\n- **Description:** Formatted subscription details\r\n- **CloseDate:** Calculated close date\r\n- **StageName:** Default to \"Prospecting\" \r\n- **Amount:** Subscription value (if available)\r\n\r\n**Response:**\r\n- **Success:** Returns Salesforce opportunity ID\r\n- **Error:** Standard Salesforce API error format\r\n\r\n### Error Codes and Handling\r\n\r\n**HTTP Status Codes:**\r\n- **200:** Webhook processed successfully\r\n- **400:** Invalid webhook payload or missing required fields\r\n- **401:** Authentication failure (invalid webhook signature)\r\n- **422:** Business logic validation failure\r\n- **500:** Internal processing error\r\n\r\n**Salesforce API Errors:**\r\n- **REQUIRED_FIELD_MISSING:** Missing required opportunity fields\r\n- **FIELD_CUSTOM_VALIDATION_EXCEPTION:** Custom validation rule failure\r\n- **INSUFFICIENT_ACCESS_ON_CROSS_REFERENCE_ENTITY:** Permission issues\r\n\r\n**Retry Logic:**\r\n- Automatic retry for transient Salesforce API failures\r\n- Exponential backoff for rate limiting scenarios\r\n- Dead letter queue for persistently failed messages",
  "markdown_length": 17857,
  "constructed_query": "Create a complete SAP iFlow integration package named 'IFlow_2e3d400e' with the following requirements from the documentation:\n\n# Stripe Subscription to Salesforce Opportunity Integration API\r\n\r\n## Table of Contents\r\n\r\n1. [API Overview](#api-overview)\r\n2. [Endpoints](#endpoints)\r\n3. [Current Boomi Flow Logic](#current-boomi-flow-logic)\r\n   - [Process Flow Overview](#process-flow-overview)\r\n   - [Step-by-Step Flow Description](#step-by-step-flow-description)\r\n     - [Step 1: Start Event (shape1)](#step-1-start-event-shape1)\r\n     - [Step 2: Document Properties (shape6)](#step-2-document-properties-shape6)\r\n     - [Step 3: Transform/Map Component (shape4)](#step-3-transformmap-component-shape4)\r\n     - [Step 4: Connector Actions (shape3)](#step-4-connector-actions-shape3)\r\n     - [Step 5: End Event (shape5)](#step-5-end-event-shape5)\r\n4. [Boomi Transformations Explained](#boomi-transformations-explained)\r\n5. [SAP Integration Suite Implementation](#sap-integration-suite-implementation)\r\n   - [Component Mapping](#component-mapping)\r\n   - [Integration Flow Visualization](#integration-flow-visualization)\r\n   - [Configuration Details](#configuration-details)\r\n6. [Environment Configuration](#environment-configuration)\r\n7. [API Reference](#api-reference)\r\n\r\n## API Overview\r\n\r\nThis integration process automates the creation of Salesforce Opportunities based on completed Stripe subscriptions. The API serves as a webhook receiver that processes Stripe subscription completion events and transforms them into structured Salesforce Opportunity records. This enables seamless revenue tracking and sales pipeline management by connecting payment processing with CRM operations.\r\n\r\n**Key Features:**\r\n- Real-time webhook processing of Stripe subscription events\r\n- Dynamic property calculation for customer and subscription details\r\n- Automated Salesforce opportunity creation with proper field mappings\r\n- Error handling and logging capabilities\r\n\r\n**Business Purpose:**\r\n- Automatically create sales opportunities when customers complete subscription purchases\r\n- Maintain accurate revenue pipeline tracking across paym\n\nGenerate a production-ready iFlow with proper:\n1. Start and End events\n2. Required adapters and connectors\n3. Content modifiers and processing steps\n4. Proper sequence flows\n5. Error handling\n6. SAP Integration Suite compliance\n",
  "query_length": 2358,
  "markdown_truncated_at": 2000,
  "api_endpoint": "/api/generate-iflow-from-markdown",
  "request_time": "2025-10-17T21:23:49.155727"
}