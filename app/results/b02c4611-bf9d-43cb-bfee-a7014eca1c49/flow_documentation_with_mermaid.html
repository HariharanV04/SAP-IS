<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation with Mermaid</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #1565c0;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
        }
        pre.mermaid {
            text-align: center;
            background: white;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .note {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #1565c0;
            margin: 10px 0;
        }
        .insights {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .best-practices {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .security {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1 id="api-overview">API Overview</h1>
<ul>
<li>This API provides product details from an SAP HANA database</li>
<li>Base URL pattern: <code>/products</code></li>
</ul>
<h1 id="endpoints">Endpoints</h1>
<h2 id="get-products">GET /products</h2>
<ul>
<li><strong>Purpose</strong>: Retrieves product details based on a product identifier</li>
<li><strong>Query Parameters</strong>:</li>
<li><code>productIdentifier</code> (required): The unique identifier for the product</li>
<li><strong>Response Format</strong>: JSON</li>
<li><strong>Status Codes</strong>:</li>
<li>200: Success</li>
<li>400: Bad Request</li>
<li>404: Product Not Found</li>
<li><strong>Response Body</strong>:</li>
<li>Success: Product details including ProductId, Category, CategoryName, etc.</li>
<li>Error: JSON object with status, message, and errorCode</li>
</ul>
<h1 id="current-mulesoft-flow-logic">Current MuleSoft Flow Logic</h1>
<h2 id="flow-products-main">Flow: products-main</h2>
<p>This is the main entry point for the API that handles HTTP requests.
1. <strong>Trigger</strong>: HTTP listener
2. <strong>Processing</strong>: Routes requests to appropriate handlers
3. <strong>Response</strong>: Returns HTTP response with appropriate headers
4. <strong>Error Handling</strong>: Provides error responses with appropriate status codes</p>
<h2 id="flow-products-console">Flow: products-console</h2>
<p>This flow appears to be a console logging version of the main flow.
1. <strong>Trigger</strong>: HTTP listener
2. <strong>Processing</strong>: Logs information to the console
3. <strong>Response</strong>: Returns HTTP response with appropriate headers
4. <strong>Error Handling</strong>: Provides error responses with appropriate status codes</p>
<h2 id="flow-getproductsproducts-config">Flow: get:\products:products-config</h2>
<p>This flow handles GET requests to the /products endpoint.
1. <strong>Trigger</strong>: GET request to /products
2. <strong>Processing</strong>: References the get-product-details-flow subflow</p>
<h2 id="subflow-get-product-details-flow">Subflow: get-product-details-flow</h2>
<p>This subflow retrieves product details from SAP HANA.
1. <strong>Validation</strong>: Checks if the provided productIdentifier is valid
2. <strong>Processing</strong>:
   - If valid: Queries SAP HANA for product details using OData
   - If invalid: Returns an error response
3. <strong>Data Transformation</strong>: Transforms the response to JSON format
4. <strong>Error Handling</strong>: Logs errors and returns appropriate error messages</p>
<p>The flow uses these key technical components:
- OData query with exact parameters:
  - <code>$filter</code>: <code>ProductId eq '" ++ (attributes.queryParams.productIdentifier default '') ++ "'</code>
  - <code>$select</code>: <code>ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit</code></p>
<h1 id="dataweave-transformations-explained">DataWeave Transformations Explained</h1>
<h2 id="transformation-1-validate-product-identifier">Transformation 1: Validate Product Identifier</h2>
<p>This transformation checks if the provided product identifier exists in a predefined list of valid product identifiers.</p>
<p><strong>Input</strong>: Query parameter <code>productIdentifier</code>
<strong>Output</strong>: Boolean value indicating if the product identifier is valid</p>
<pre class="codehilite"><code class="language-dw">%dw 2.0
output application/java
var productidentifer=p('odata.productIdentifiers') splitBy(&quot;,&quot;)
---
sizeOf(productidentifer filter ($ == attributes.queryParams.productIdentifier))&gt;0
</code></pre>

<p>This transformation:
1. Retrieves a comma-separated list of valid product identifiers from a property
2. Splits the list into an array
3. Filters the array to find matches with the provided product identifier
4. Returns true if at least one match is found (size &gt; 0)</p>
<h2 id="transformation-2-odata-query-parameters">Transformation 2: OData Query Parameters</h2>
<p>This transformation constructs OData query parameters for the HTTP request to SAP HANA.</p>
<p><strong>Input</strong>: Query parameter <code>productIdentifier</code>
<strong>Output</strong>: OData query parameters as a Java object</p>
<pre class="codehilite"><code class="language-dw">output application/java
---
{
    &quot;$filter&quot; : &quot;ProductId eq '&quot; ++ (attributes.queryParams.productIdentifier default '') ++ &quot;'&quot;,
    &quot;$select&quot; : &quot;ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit&quot;
}
</code></pre>

<p>This transformation:
1. Creates a filter condition to match the exact product identifier
2. Specifies the fields to be returned in the response</p>
<h2 id="transformation-3-pass-through-response">Transformation 3: Pass-through Response</h2>
<p>This transformation simply passes the payload through without modification.</p>
<p><strong>Input</strong>: SAP HANA response
<strong>Output</strong>: Same payload as JSON</p>
<pre class="codehilite"><code class="language-dw">%dw 2.0
output application/json
---
payload
</code></pre>

<h2 id="transformation-4-error-response">Transformation 4: Error Response</h2>
<p>This transformation creates an error response when the product identifier is not found or invalid.</p>
<p><strong>Input</strong>: Query parameter <code>productIdentifier</code>
<strong>Output</strong>: JSON error object</p>
<pre class="codehilite"><code class="language-dw">%dw 2.0
output application/json
---
{
    status: &quot;error&quot;,
    message: &quot;The product identifier &quot; ++ attributes.queryParams.productIdentifier ++ &quot; was not found.&quot;,
    errorCode: &quot;PRODUCT_NOT_FOUND&quot;
}
</code></pre>

<p>This transformation:
1. Creates a standardized error response object
2. Includes the invalid product identifier in the error message
3. Sets a specific error code for product not found scenarios</p>
<h1 id="sap-integration-suite-implementation">SAP Integration Suite Implementation</h1>
<h2 id="component-mapping">Component Mapping</h2>
<table>
<thead>
<tr>
<th>MuleSoft Component</th>
<th>SAP Integration Suite Equivalent</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTP Listener</td>
<td>HTTPS Adapter (Server)</td>
<td>Configure with the same port and path</td>
</tr>
<tr>
<td>Router</td>
<td>Content Modifier + Router</td>
<td>Use a Content Modifier to set properties and a Router for conditional processing</td>
</tr>
<tr>
<td>Flow Reference</td>
<td>Process Call</td>
<td>References another integration flow</td>
</tr>
<tr>
<td>Transform</td>
<td>Message Mapping</td>
<td>Maps data between different formats</td>
</tr>
<tr>
<td>Logger</td>
<td>Write to Message Log</td>
<td>Logs messages to the integration flow log</td>
</tr>
<tr>
<td>HTTP Request</td>
<td>OData Adapter (Client)</td>
<td>Configure to connect to SAP HANA</td>
</tr>
<tr>
<td>Set Variable</td>
<td>Content Modifier</td>
<td>Sets flow variables</td>
</tr>
<tr>
<td>Choice/When/Otherwise</td>
<td>Router</td>
<td>Implements conditional logic</td>
</tr>
<tr>
<td>Set Payload</td>
<td>Content Modifier</td>
<td>Sets the message payload</td>
</tr>
<tr>
<td>Error Handler</td>
<td>Exception Subprocess</td>
<td>Handles errors with specific error codes</td>
</tr>
</tbody>
</table>
<h2 id="integration-flow-visualization">Integration Flow Visualization</h2>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow: products-main
start1((Start)) --> listener1[HTTP Listener]:::httpAdapter
listener1 --> router1{Router}:::router
router1 -->|Route| response1[Response]:::httpAdapter
response1 --> headers1[Headers]:::contentModifier
headers1 --> body1[Body]:::contentModifier
body1 --> headers2[Headers]:::contentModifier

%% Error handling
listener1 -.-> errorResponse[Error Response]:::exception
errorResponse --> headers3[Headers]:::contentModifier
</pre>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow: products-console
start2((Start)) --> listener2[HTTP Listener]:::httpAdapter
listener2 --> response2[Response]:::httpAdapter
response2 --> headers4[Headers]:::contentModifier
headers4 --> console[Console]:::contentModifier

%% Error handling
listener2 -.-> errorResponse2[Error Response]:::exception
errorResponse2 --> headers5[Headers]:::contentModifier
</pre>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow: get:\products:products-config
start3((Start)) --> getProductDetailsFlow[[get-product-details-flow]]:::processCall
</pre>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow: get-product-details-flow
start4((Start)) --> transform1[Transform]:::mapping
transform1 -->|Set isExistProduct| message1[Message]:::contentModifier
message1 --> variables[Variables]:::contentModifier
variables --> setVariable[Set Variable]:::contentModifier
setVariable --> choice{Choice}:::router

choice -->|isExistProduct = true| logger1[Logger]:::contentModifier
logger1 --> request[OData Request]:::httpAdapter
request -->|$filter, $select| queryParams[Query Params]:::contentModifier
queryParams --> transform2[Transform]:::mapping
transform2 --> message2[Set Payload]:::contentModifier

choice -->|isExistProduct = false| logger2[Logger]:::contentModifier
logger2 --> transform3[Transform Error]:::mapping
transform3 --> message3[Set Payload]:::contentModifier

message2 --> end4((End))
message3 --> end4
</pre>
<h2 id="configuration-details">Configuration Details</h2>
<h3 id="http-listener-https-adapter-server">HTTP Listener (HTTPS Adapter - Server)</h3>
<ul>
<li><strong>Address</strong>: <code>/products</code></li>
<li><strong>Port</strong>: Same as HTTP_Listener_config</li>
<li><strong>Authentication</strong>: As per source configuration</li>
</ul>
<h3 id="odata-adapter-client">OData Adapter (Client)</h3>
<ul>
<li><strong>Connection</strong>: SAP HANA connection</li>
<li><strong>Service</strong>: Product service</li>
<li><strong>Query Parameters</strong>:</li>
<li><code>$filter</code>: <code>ProductId eq '{productIdentifier}'</code></li>
<li><code>$select</code>: <code>ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit</code></li>
</ul>
<h3 id="message-mapping-transform">Message Mapping (Transform)</h3>
<ul>
<li><strong>Input Format</strong>: As per source</li>
<li><strong>Output Format</strong>: JSON</li>
<li><strong>Mapping Script</strong>: Equivalent to the DataWeave transformations</li>
</ul>
<h3 id="router-choice">Router (Choice)</h3>
<ul>
<li><strong>Condition</strong>: <code>${property.isExistProduct}</code></li>
<li><strong>True Path</strong>: Process valid product request</li>
<li><strong>False Path</strong>: Return error response</li>
</ul>
<h3 id="content-modifier-set-variable">Content Modifier (Set Variable)</h3>
<ul>
<li><strong>Variable Name</strong>: <code>isExistProduct</code></li>
<li><strong>Value</strong>: Result of product identifier validation</li>
</ul>
<h3 id="write-to-message-log-logger">Write to Message Log (Logger)</h3>
<ul>
<li><strong>Log Level</strong>: INFO</li>
<li><strong>Message</strong>: Same as source logger messages</li>
</ul>
<h1 id="configuration">Configuration</h1>
<ul>
<li><strong>Property</strong>: <code>odata.productIdentifiers</code> - Comma-separated list of valid product identifiers</li>
<li><strong>HTTP Listener Configuration</strong>: As per HTTP_Listener_config</li>
<li><strong>Request Configuration</strong>: As per Hana_HTTP_Request_Configuration</li>
<li><strong>API Configuration</strong>: Based on products.raml</li>
<li><strong>Error Handling</strong>: Global error handler for APIKIT errors</li>
</ul>
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>