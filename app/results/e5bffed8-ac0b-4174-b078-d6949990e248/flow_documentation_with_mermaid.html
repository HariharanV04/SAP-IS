<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation with Mermaid</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #1565c0;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
        }
        pre.mermaid {
            text-align: center;
            background: white;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .note {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #1565c0;
            margin: 10px 0;
        }
        .insights {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .best-practices {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .security {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1 id="api-overview">API Overview</h1>
<p>The Financial Services Cloud Wealth Management API provides a comprehensive set of endpoints for managing investment accounts, beneficiaries, standing orders, and customer profiles. It enables financial institutions to handle various wealth management operations including account creation, beneficiary management, payment processing, and account transfers.</p>
<ul>
<li>Base URL: <code>/api/v1</code></li>
</ul>
<h1 id="endpoints">Endpoints</h1>
<h2 id="investment-accounts">Investment Accounts</h2>
<h3 id="post-investmentaccountsinitiate">POST /InvestmentAccounts/Initiate</h3>
<ul>
<li><strong>Purpose</strong>: Initiates a new investment account with beneficiaries</li>
<li><strong>Request Body</strong>: JSON containing investment account and beneficiary details</li>
<li><strong>Response</strong>: 201 Created with the created beneficiary details including generated IDs</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;InvestmentAccounts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;AccountIds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ACC123456&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Beneficiaries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Primary&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BFR-1234567&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;SharePercentage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;50&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Contingent&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BFR-7654321&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;SharePercentage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;50&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="patch-investmentaccountsupdate">PATCH /InvestmentAccounts/Update</h3>
<ul>
<li><strong>Purpose</strong>: Updates existing beneficiaries for investment accounts</li>
<li><strong>Request Body</strong>: JSON containing investment account IDs and updated beneficiary details</li>
<li><strong>Response</strong>: 200 OK with updated beneficiary details</li>
</ul>
<h3 id="delete-investmentaccountsdelete">DELETE /InvestmentAccounts/Delete</h3>
<ul>
<li><strong>Purpose</strong>: Deletes beneficiaries from investment accounts</li>
<li><strong>Request Body</strong>: JSON containing account IDs and beneficiary IDs to delete</li>
<li><strong>Response</strong>: 200 OK with confirmation of deleted beneficiaries</li>
</ul>
<h3 id="get-investmentaccountsaccountidretrieve">GET /InvestmentAccounts/{accountId}/Retrieve</h3>
<ul>
<li><strong>Purpose</strong>: Retrieves investment account details including beneficiaries</li>
<li><strong>Path Parameters</strong>: <code>accountId</code> - The ID of the investment account</li>
<li><strong>Response</strong>: 200 OK with account and beneficiary details</li>
</ul>
<h2 id="payments">Payments</h2>
<h3 id="post-investmentaccountsaccountidpaymentsinitiate">POST /InvestmentAccounts/{accountId}/Payments/Initiate</h3>
<ul>
<li><strong>Purpose</strong>: Initiates standing orders for an investment account</li>
<li><strong>Path Parameters</strong>: <code>accountId</code> - The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing payment details</li>
<li><strong>Response</strong>: 201 Created with created payment order details including generated IDs</li>
</ul>
<h3 id="patch-investmentaccountsaccountidpaymentsupdate">PATCH /InvestmentAccounts/{accountId}/Payments/Update</h3>
<ul>
<li><strong>Purpose</strong>: Updates or cancels existing standing orders</li>
<li><strong>Path Parameters</strong>: <code>accountId</code> - The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing payment IDs to cancel</li>
<li><strong>Response</strong>: 200 OK with confirmation of cancellation</li>
</ul>
<h3 id="get-investmentaccountsaccountidpaymentsretrieve">GET /InvestmentAccounts/{accountId}/Payments/Retrieve</h3>
<ul>
<li><strong>Purpose</strong>: Retrieves standing orders for an investment account</li>
<li><strong>Path Parameters</strong>: <code>accountId</code> - The ID of the investment account</li>
<li><strong>Query Parameters</strong>: </li>
<li><code>paymentId</code> (optional) - Filter by payment ID</li>
<li><code>payeeName</code> (optional) - Filter by payee name</li>
<li><code>amount</code> (optional) - Filter by payment amount</li>
<li><strong>Response</strong>: 200 OK with matching payment orders</li>
</ul>
<h2 id="customer-profile">Customer Profile</h2>
<h3 id="patch-customerscustomerid">PATCH /customers/{customerId}</h3>
<ul>
<li><strong>Purpose</strong>: Updates customer profile information</li>
<li><strong>Path Parameters</strong>: <code>customerId</code> - The ID of the customer</li>
<li><strong>Request Body</strong>: JSON containing updated profile information</li>
<li><strong>Response</strong>: 200 OK with updated profile details</li>
</ul>
<h2 id="special-transactions">Special Transactions</h2>
<h3 id="post-investmentaccountsaccountidacats">POST /InvestmentAccounts/{accountId}/Acats</h3>
<ul>
<li><strong>Purpose</strong>: Initiates an ACATS (Automated Customer Account Transfer Service) transaction</li>
<li><strong>Path Parameters</strong>: <code>accountId</code> - The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing ACATS transfer details</li>
<li><strong>Response</strong>: 200 OK with ACATS transaction details</li>
</ul>
<h3 id="post-investmentaccountsaccountidrmd">POST /InvestmentAccounts/{accountId}/RMD</h3>
<ul>
<li><strong>Purpose</strong>: Initiates a Required Minimum Distribution (RMD) transaction</li>
<li><strong>Path Parameters</strong>: <code>accountId</code> - The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing RMD details</li>
<li><strong>Response</strong>: 200 OK with RMD transaction details</li>
</ul>
<h1 id="current-mulesoft-flow-logic">Current MuleSoft Flow Logic</h1>
<h2 id="main-api-flow">Main API Flow</h2>
<p>The main flow (<code>fsc-wealth-management-api-main</code>) serves as the entry point for all API requests:</p>
<ol>
<li><strong>Trigger</strong>: HTTP listener configured to receive requests</li>
<li><strong>Processing</strong>:</li>
<li>Logs request details including requestId and flowRefId from query parameters</li>
<li>Routes requests to appropriate endpoint handlers</li>
<li>Sets appropriate response headers</li>
<li><strong>Error Handling</strong>: Implements comprehensive error handling for various HTTP status codes</li>
</ol>
<h2 id="beneficiary-management-flows">Beneficiary Management Flows</h2>
<h3 id="add-beneficiaries-flow">Add Beneficiaries Flow</h3>
<p><strong>Flow</strong>: <code>post:\InvestmentAccounts\Initiate:application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/Initiate</code></li>
<li><strong>Processing</strong>: Calls the <code>add-beneficiaries-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Transforms the request payload and generates unique beneficiary IDs</li>
<li><strong>Expected Outcome</strong>: Returns a 201 Created response with the created beneficiaries</li>
</ol>
<p>The <code>add-beneficiaries-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">AccountIds</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Primary</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}),</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="update-beneficiaries-flow">Update Beneficiaries Flow</h3>
<p><strong>Flow</strong>: <code>patch:\InvestmentAccounts\Update:application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: PATCH request to <code>/InvestmentAccounts/Update</code></li>
<li><strong>Processing</strong>: Calls the <code>update-beneficiaries-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Updates beneficiary details and generates IDs for new beneficiaries</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with updated beneficiaries</li>
</ol>
<p>The <code>update-beneficiaries-sub-flow</code> uses a complex DataWeave transformation with a custom tree filtering function:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>

<span class="n">fun</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="w"> </span><span class="n">Any</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="n">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Boolean</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">value</span><span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">object</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">  </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">               </span><span class="no">object</span><span class="w"> </span><span class="no">mapObject</span><span class="w"> </span><span class="p">((</span><span class="no">value</span><span class="p">,</span><span class="w"> </span><span class="no">key</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="no">key</span><span class="p">):</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">filterObject</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">array</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="no">array</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">treeFilter</span><span class="p">(</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">predicate</span><span class="p">))</span>
<span class="w">                                         </span><span class="no">filter</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">predicate</span><span class="p">(</span><span class="no">item</span><span class="p">))</span><span class="w">                 </span>
<span class="w">            </span><span class="err">}</span>
<span class="w">            </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">$</span>
<span class="w">    </span><span class="err">}</span>

<span class="no">output</span><span class="w"> </span><span class="no">application</span><span class="o">/</span><span class="no">json</span><span class="w"> </span><span class="no">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="err">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">AccountIds</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="no">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Addresses</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Beneficiaries</span><span class="p">.</span><span class="no">Primary</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="no">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">$</span><span class="p">.</span><span class="no">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="no">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="n">treeFilter</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="o">|</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">Null</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="no">isEmpty</span><span class="p">(</span><span class="no">v</span><span class="p">)</span>
<span class="w">        </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="err">}</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="delete-beneficiaries-flow">Delete Beneficiaries Flow</h3>
<p><strong>Flow</strong>: <code>delete:\InvestmentAccounts\Delete:application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: DELETE request to <code>/InvestmentAccounts/Delete</code></li>
<li><strong>Processing</strong>: Calls the <code>delete-beneficiaries-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Marks specified beneficiaries as deleted</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with confirmation</li>
</ol>
<p>The <code>delete-beneficiaries-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">AccountIds</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">BeneficiaryId</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DELETED&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="retrieve-investment-account-details-flow">Retrieve Investment Account Details Flow</h3>
<p><strong>Flow</strong>: <code>get:\InvestmentAccounts\(accountId)\Retrieve:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: GET request to <code>/InvestmentAccounts/{accountId}/Retrieve</code></li>
<li><strong>Processing</strong>: Calls the <code>retrieve-investment-account-details-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Sets account details in a variable and transforms the response</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with account and beneficiary details</li>
</ol>
<p>The <code>retrieve-investment-account-details-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">LinkedAccount</span><span class="p">:</span><span class="w"> </span><span class="n">vars</span><span class="p">.</span><span class="n">investmentAccountDetails</span><span class="p">.</span><span class="n">LinkedAccount</span><span class="p">,</span>
<span class="w">    </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="n">vars</span><span class="p">.</span><span class="n">investmentAccountDetails</span><span class="p">.</span><span class="n">Beneficiaries</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="payment-management-flows">Payment Management Flows</h2>
<h3 id="add-standing-orders-flow">Add Standing Orders Flow</h3>
<p><strong>Flow</strong>: <code>post:\InvestmentAccounts\(accountId)\Payments\Initiate:application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/{accountId}/Payments/Initiate</code></li>
<li><strong>Processing</strong>: Calls the <code>add-standing-orders-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Generates unique payment IDs and adds creation timestamps</li>
<li><strong>Expected Outcome</strong>: Returns a 201 Created response with the created payment orders</li>
</ol>
<p>The <code>add-standing-orders-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">sot</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PMT&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">stordTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;STORDTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">sotNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">Payments</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">Payments</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">CreationDateTime</span><span class="p">:</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span>
<span class="w">        </span><span class="nl">PaymentId</span><span class="p">:</span><span class="w"> </span><span class="n">sot</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">sotNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">sotCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="cancel-standing-orders-flow">Cancel Standing Orders Flow</h3>
<p><strong>Flow</strong>: <code>patch:\InvestmentAccounts\(accountId)\Payments\Update:application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: PATCH request to <code>/InvestmentAccounts/{accountId}/Payments/Update</code></li>
<li><strong>Processing</strong>: Calls the <code>cancel-standing-orders-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Adds cancellation timestamp to the response</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with cancellation confirmation</li>
</ol>
<p>The <code>cancel-standing-orders-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">PaymentIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentIds</span><span class="p">,</span>
<span class="w">    </span><span class="nl">CancelDateTime</span><span class="p">:</span><span class="w"> </span><span class="n">now</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="retrieve-standing-orders-flow">Retrieve Standing Orders Flow</h3>
<p><strong>Flow</strong>: <code>get:\InvestmentAccounts\(accountId)\Payments\Retrieve:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: GET request to <code>/InvestmentAccounts/{accountId}/Payments/Retrieve</code></li>
<li><strong>Processing</strong>: </li>
<li>Logs query parameters</li>
<li>Calls the <code>retrieve-standing-orders-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Filters payment orders based on query parameters</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with matching payment orders</li>
</ol>
<p>The <code>retrieve-standing-orders-sub-flow</code> uses this DataWeave transformation with complex conditional filtering:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">  </span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">  </span><span class="nl">PaymentOrders</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="customer-profile-management-flow">Customer Profile Management Flow</h2>
<h3 id="update-customer-profile-flow">Update Customer Profile Flow</h3>
<p><strong>Flow</strong>: <code>patch:\customers\(customerId):application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: PATCH request to <code>/customers/{customerId}</code></li>
<li><strong>Processing</strong>: Calls the <code>update-customers-profile-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Transforms the profile information</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with updated profile details</li>
</ol>
<p>The <code>update-customers-profile-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">ProfileInformation</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">ProfileInformation</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Addresses</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAddress</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">AddressLine2</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine2</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressLine1</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine1</span><span class="p">,</span>
<span class="w">            </span><span class="nl">State</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">State</span><span class="p">,</span>
<span class="w">            </span><span class="nl">PostalCode</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">PostalCode</span><span class="p">,</span>
<span class="w">            </span><span class="nl">City</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">City</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressType</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressType</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Country</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">Country</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">Email</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span>
<span class="w">        </span><span class="nl">FirstName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Phone</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Phone</span><span class="p">,</span>
<span class="w">        </span><span class="nl">LastName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Mobile</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Mobile</span><span class="p">,</span>
<span class="w">        </span><span class="nl">BirthDate</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">BirthDate</span><span class="p">,</span>
<span class="w">        </span><span class="nl">MaritalStatus</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">MaritalStatus</span><span class="p">,</span>
<span class="w">        </span><span class="nl">EmploymentDetails</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">EmploymentDetails</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="special-transaction-flows">Special Transaction Flows</h2>
<h3 id="acats-transaction-flow">ACATS Transaction Flow</h3>
<p><strong>Flow</strong>: <code>post:\InvestmentAccounts\(accountId)\Acats:application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/{accountId}/Acats</code></li>
<li><strong>Processing</strong>: Calls the <code>prepare-acats-response-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Transforms the ACATS details</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with ACATS transaction details</li>
</ol>
<p>The <code>prepare-acats-response-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">AcatDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">TransferType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferType</span><span class="p">,</span>
<span class="w">        </span><span class="nl">AcatType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">AcatType</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">null</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TransferAction</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferAction</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TransferDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">Securities</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">Securities</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Cash</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">Cash</span><span class="p">,</span>
<span class="w">            </span><span class="nl">FundsTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">FundsTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">CashTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">CashTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">CDTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">CDTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AnnuityTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">AnnuityTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">ManagedAccountTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">ManagedAccountTransfer</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">ExternalAccountDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">AccountNumber</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AccountType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountType</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AccountTitle</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountTitle</span><span class="p">,</span>
<span class="w">            </span><span class="nl">TransferringFirmDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">FirmName</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">FirmName</span><span class="p">,</span>
<span class="w">                </span><span class="nl">Phone</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">Phone</span><span class="p">,</span>
<span class="w">                </span><span class="nl">Address</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">Address</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="rmd-transaction-flow">RMD Transaction Flow</h3>
<p><strong>Flow</strong>: <code>post:\InvestmentAccounts\(accountId)\RMD:application\json:fsc-wealth-management-api-config</code></p>
<ol>
<li><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/{accountId}/RMD</code></li>
<li><strong>Processing</strong>: Calls the <code>prepare-rmd-response-sub-flow</code> subflow</li>
<li><strong>Data Transformation</strong>: Transforms the RMD details</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with RMD transaction details</li>
</ol>
<p>The <code>prepare-rmd-response-sub-flow</code> uses this DataWeave transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">        </span><span class="nl">PaymentOption</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentOption</span><span class="p">,</span>
<span class="w">        </span><span class="nl">PaymentFrequency</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentFrequency</span><span class="p">,</span>
<span class="w">        </span><span class="nl">DistributionSchedule</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">DistributionSchedule</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TaxYear</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">TaxYear</span><span class="p">,</span>
<span class="w">        </span><span class="nl">CalculateRMDAmount</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">CalculateRMDAmount</span><span class="p">,</span>
<span class="w">        </span><span class="nl">WithdrawlAmount</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">WithdrawlAmount</span><span class="p">,</span>
<span class="w">        </span><span class="nl">PaymentInstructions</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentInstructions</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TaxWithholdings</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">TaxWithholdings</span>
<span class="p">}</span>
</code></pre></div>

<h1 id="dataweave-transformations-explained">DataWeave Transformations Explained</h1>
<h2 id="p-addbeneficiariesresponsedwl">p-addBeneficiariesResponse.dwl</h2>
<p><strong>Purpose</strong>: Generates unique beneficiary IDs for new beneficiaries and structures the response.</p>
<p><strong>Input</strong>: JSON payload containing investment account IDs and beneficiary details.</p>
<p><strong>Output</strong>: JSON with the same structure but with added BeneficiaryId fields.</p>
<p><strong>Key Operations</strong>:
- Uses variables to define the ID prefix and character set
- Uses <code>map</code> to iterate through arrays of beneficiaries
- Uses <code>randomInt</code> to generate random numbers for IDs
- Uses <code>skipNullOn = "everywhere"</code> to omit null values from the output</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">AccountIds</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Primary</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}),</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-updatebeneficiariesresponsedwl">p-updateBeneficiariesResponse.dwl</h2>
<p><strong>Purpose</strong>: Updates beneficiary details and generates IDs for new beneficiaries, while filtering out empty values.</p>
<p><strong>Input</strong>: JSON payload containing investment account IDs and beneficiary details.</p>
<p><strong>Output</strong>: JSON with updated beneficiary details and new IDs for new beneficiaries.</p>
<p><strong>Key Operations</strong>:
- Defines a custom <code>treeFilter</code> function to recursively filter out empty values
- Uses conditional mapping to only generate IDs for beneficiaries without existing IDs
- Uses pattern matching to determine if values are empty</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>

<span class="n">fun</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="w"> </span><span class="n">Any</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="n">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Boolean</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">value</span><span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">object</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">  </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">               </span><span class="no">object</span><span class="w"> </span><span class="no">mapObject</span><span class="w"> </span><span class="p">((</span><span class="no">value</span><span class="p">,</span><span class="w"> </span><span class="no">key</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="no">key</span><span class="p">):</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">filterObject</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">array</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="no">array</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">treeFilter</span><span class="p">(</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">predicate</span><span class="p">))</span>
<span class="w">                                         </span><span class="no">filter</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">predicate</span><span class="p">(</span><span class="no">item</span><span class="p">))</span><span class="w">                 </span>
<span class="w">            </span><span class="err">}</span>
<span class="w">            </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">$</span>
<span class="w">    </span><span class="err">}</span>

<span class="no">output</span><span class="w"> </span><span class="no">application</span><span class="o">/</span><span class="no">json</span><span class="w"> </span><span class="no">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="err">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">AccountIds</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="no">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Addresses</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Beneficiaries</span><span class="p">.</span><span class="no">Primary</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="no">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">$</span><span class="p">.</span><span class="no">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="no">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="n">treeFilter</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="o">|</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">Null</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="no">isEmpty</span><span class="p">(</span><span class="no">v</span><span class="p">)</span>
<span class="w">        </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="err">}</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="p-deletebeneficiariesresponsedwl">p-deleteBeneficiariesResponse.dwl</h2>
<p><strong>Purpose</strong>: Transforms the request to mark specified beneficiaries as deleted.</p>
<p><strong>Input</strong>: JSON payload containing account IDs and beneficiary IDs to delete.</p>
<p><strong>Output</strong>: JSON with beneficiary IDs and a "DELETED" status.</p>
<p><strong>Key Operations</strong>:
- Maps through account IDs to maintain the structure
- Maps through beneficiaries to extract IDs and add a status field</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">AccountIds</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">BeneficiaryId</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DELETED&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-getbeneficiariesresponsedwl">p-getBeneficiariesResponse.dwl</h2>
<p><strong>Purpose</strong>: Retrieves account and beneficiary details from a variable.</p>
<p><strong>Input</strong>: None (uses variables).</p>
<p><strong>Output</strong>: JSON with linked account and beneficiary details.</p>
<p><strong>Key Operations</strong>:
- Accesses the <code>investmentAccountDetails</code> variable to get account and beneficiary information</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">LinkedAccount</span><span class="p">:</span><span class="w"> </span><span class="n">vars</span><span class="p">.</span><span class="n">investmentAccountDetails</span><span class="p">.</span><span class="n">LinkedAccount</span><span class="p">,</span>
<span class="w">    </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="n">vars</span><span class="p">.</span><span class="n">investmentAccountDetails</span><span class="p">.</span><span class="n">Beneficiaries</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-addpaymentordersresponsedwl">p-addPaymentOrdersResponse.dwl</h2>
<p><strong>Purpose</strong>: Generates unique payment IDs and adds creation timestamps to payment orders.</p>
<p><strong>Input</strong>: JSON payload containing payment details.</p>
<p><strong>Output</strong>: JSON with payment details, creation timestamps, and unique IDs.</p>
<p><strong>Key Operations</strong>:
- Uses variables to define the ID prefix and character set
- Uses <code>map</code> to iterate through payments
- Uses <code>now()</code> to generate current timestamps
- Uses <code>randomInt</code> to generate random numbers for IDs</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">sot</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PMT&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">stordTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;STORDTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">sotNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">Payments</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">Payments</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">CreationDateTime</span><span class="p">:</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span>
<span class="w">        </span><span class="nl">PaymentId</span><span class="p">:</span><span class="w"> </span><span class="n">sot</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">sotNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">sotCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-cancelpaymentordersresponsedwl">p-cancelPaymentOrdersResponse.dwl</h2>
<p><strong>Purpose</strong>: Adds a cancellation timestamp to the payment cancellation response.</p>
<p><strong>Input</strong>: JSON payload containing payment IDs to cancel.</p>
<p><strong>Output</strong>: JSON with payment IDs and a cancellation timestamp.</p>
<p><strong>Key Operations</strong>:
- Passes through the payment IDs from the input
- Adds a <code>CancelDateTime</code> field with the current timestamp</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">PaymentIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentIds</span><span class="p">,</span>
<span class="w">    </span><span class="nl">CancelDateTime</span><span class="p">:</span><span class="w"> </span><span class="n">now</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-retrievepaymentordersresponsedwl">p-retrievePaymentOrdersResponse.dwl</h2>
<p><strong>Purpose</strong>: Filters payment orders based on query parameters.</p>
<p><strong>Input</strong>: None (uses variables and query parameters).</p>
<p><strong>Output</strong>: JSON with filtered payment orders.</p>
<p><strong>Key Operations</strong>:
- Uses nested conditional statements to filter payment orders based on combinations of query parameters
- Uses the <code>~=</code> operator for approximate matching
- Handles all possible combinations of the three filter parameters (paymentId, payeeName, amount)</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">  </span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">  </span><span class="nl">PaymentOrders</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-updateprofileresponsedwl">p-updateProfileResponse.dwl</h2>
<p><strong>Purpose</strong>: Transforms customer profile information for the response.</p>
<p><strong>Input</strong>: JSON payload containing profile information.</p>
<p><strong>Output</strong>: JSON with structured profile information.</p>
<p><strong>Key Operations</strong>:
- Uses a variable to store the profile information for easier access
- Maps through address arrays to maintain the structure
- Uses <code>skipNullOn="everywhere"</code> to omit null values from the output</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">ProfileInformation</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">ProfileInformation</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Addresses</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAddress</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">AddressLine2</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine2</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressLine1</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine1</span><span class="p">,</span>
<span class="w">            </span><span class="nl">State</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">State</span><span class="p">,</span>
<span class="w">            </span><span class="nl">PostalCode</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">PostalCode</span><span class="p">,</span>
<span class="w">            </span><span class="nl">City</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">City</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressType</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressType</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Country</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">Country</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">Email</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span>
<span class="w">        </span><span class="nl">FirstName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Phone</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Phone</span><span class="p">,</span>
<span class="w">        </span><span class="nl">LastName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Mobile</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Mobile</span><span class="p">,</span>
<span class="w">        </span><span class="nl">BirthDate</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">BirthDate</span><span class="p">,</span>
<span class="w">        </span><span class="nl">MaritalStatus</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">MaritalStatus</span><span class="p">,</span>
<span class="w">        </span><span class="nl">EmploymentDetails</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">EmploymentDetails</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-acatresponsedwl">p-acatResponse.dwl</h2>
<p><strong>Purpose</strong>: Transforms ACATS transaction details for the response.</p>
<p><strong>Input</strong>: JSON payload containing ACATS details.</p>
<p><strong>Output</strong>: JSON with structured ACATS transaction details.</p>
<p><strong>Key Operations</strong>:
- Maintains the nested structure of the ACATS details
- Uses <code>default null</code> to handle missing values
- Uses <code>skipNullOn="everywhere"</code> to omit null values from the output</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">AcatDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">TransferType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferType</span><span class="p">,</span>
<span class="w">        </span><span class="nl">AcatType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">AcatType</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">null</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TransferAction</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferAction</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TransferDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">Securities</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">Securities</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Cash</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">Cash</span><span class="p">,</span>
<span class="w">            </span><span class="nl">FundsTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">FundsTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">CashTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">CashTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">CDTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">CDTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AnnuityTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">AnnuityTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">ManagedAccountTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">ManagedAccountTransfer</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">ExternalAccountDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">AccountNumber</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AccountType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountType</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AccountTitle</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountTitle</span><span class="p">,</span>
<span class="w">            </span><span class="nl">TransferringFirmDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">FirmName</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">FirmName</span><span class="p">,</span>
<span class="w">                </span><span class="nl">Phone</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">Phone</span><span class="p">,</span>
<span class="w">                </span><span class="nl">Address</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">Address</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="p-rmdresponsedwl">p-rmdResponse.dwl</h2>
<p><strong>Purpose</strong>: Transforms RMD transaction details for the response.</p>
<p><strong>Input</strong>: JSON payload containing RMD details.</p>
<p><strong>Output</strong>: JSON with structured RMD transaction details.</p>
<p><strong>Key Operations</strong>:
- Passes through RMD details from the input
- Uses <code>skipNullOn="everywhere"</code> to omit null values from the output</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">        </span><span class="nl">PaymentOption</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentOption</span><span class="p">,</span>
<span class="w">        </span><span class="nl">PaymentFrequency</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentFrequency</span><span class="p">,</span>
<span class="w">        </span><span class="nl">DistributionSchedule</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">DistributionSchedule</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TaxYear</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">TaxYear</span><span class="p">,</span>
<span class="w">        </span><span class="nl">CalculateRMDAmount</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">CalculateRMDAmount</span><span class="p">,</span>
<span class="w">        </span><span class="nl">WithdrawlAmount</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">WithdrawlAmount</span><span class="p">,</span>
<span class="w">        </span><span class="nl">PaymentInstructions</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentInstructions</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TaxWithholdings</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">TaxWithholdings</span>
<span class="p">}</span>
</code></pre></div>

<h1 id="sap-integration-suite-implementation">SAP Integration Suite Implementation</h1>
<h2 id="component-mapping">Component Mapping</h2>
<table>
<thead>
<tr>
<th>MuleSoft Component</th>
<th>SAP Integration Suite Equivalent</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>listener</td>
<td>HTTPS Adapter</td>
<td>Configure with the same endpoint paths and methods</td>
</tr>
<tr>
<td>router</td>
<td>Router</td>
<td>Maps to Content Modifier with routing logic</td>
</tr>
<tr>
<td>flow-ref</td>
<td>Process Call</td>
<td>Used to call subflows</td>
</tr>
<tr>
<td>set-variable</td>
<td>Content Modifier</td>
<td>Used to set variables</td>
</tr>
<tr>
<td>transform</td>
<td>Message Mapping</td>
<td>Maps to the SAP Integration Suite mapping component</td>
</tr>
<tr>
<td>set-payload</td>
<td>Content Modifier</td>
<td>Used to set the message payload</td>
</tr>
<tr>
<td>logger</td>
<td>Write Message to Log</td>
<td>Configure with the same log messages</td>
</tr>
<tr>
<td>error-handler</td>
<td>Exception Subprocess</td>
<td>Maps to exception handling in SAP Integration Suite</td>
</tr>
<tr>
<td>headers</td>
<td>Content Modifier</td>
<td>Used to set HTTP headers</td>
</tr>
<tr>
<td>response</td>
<td>Content Modifier</td>
<td>Used to prepare the HTTP response</td>
</tr>
</tbody>
</table>
<h2 id="integration-flow-visualization">Integration Flow Visualization</h2>
<h3 id="flow-1-main-api-flow">Flow 1: Main API Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Main API Flow
A((Start)) --> B[HTTP Listener]:::httpAdapter
B --> C[Set Response]:::contentModifier
C --> D[Set Headers]:::contentModifier
D --> E[Log Request]:::contentModifier
E --> F[Log Payload]:::contentModifier
F --> G{Route Request}:::router
G -->|Investment Accounts| H[[Process Investment Accounts]]:::processCall
G -->|Customer Profile| I[[Process Customer Profile]]:::processCall
G -->|Payments| J[[Process Payments]]:::processCall
G -->|Special Transactions| K[[Process Special Transactions]]:::processCall
H --> L[Log Response]:::contentModifier
I --> L
J --> L
K --> L
L --> M((End))

%% Error Handling
B -->|Error| N[(Error Handler)]:::exception
N --> O[Set Error Response]:::contentModifier
O --> P[Set Error Headers]:::contentModifier
P --> Q[Set Error Body]:::contentModifier
Q --> M
</pre>
<h3 id="flow-2-add-beneficiaries-flow">Flow 2: Add Beneficiaries Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Add Beneficiaries Flow
A((Start)) --> B[POST /InvestmentAccounts/Initiate]:::httpAdapter
B --> C[[add-beneficiaries-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h3 id="flow-3-update-beneficiaries-flow">Flow 3: Update Beneficiaries Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Update Beneficiaries Flow
A((Start)) --> B[PATCH /InvestmentAccounts/Update]:::httpAdapter
B --> C[[update-beneficiaries-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h3 id="flow-4-delete-beneficiaries-flow">Flow 4: Delete Beneficiaries Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Delete Beneficiaries Flow
A((Start)) --> B[DELETE /InvestmentAccounts/Delete]:::httpAdapter
B --> C[[delete-beneficiaries-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h3 id="flow-5-retrieve-investment-account-details-flow">Flow 5: Retrieve Investment Account Details Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Retrieve Investment Account Details Flow
A((Start)) --> B[GET /InvestmentAccounts/accountId/Retrieve]:::httpAdapter
B --> C[[retrieve-investment-account-details-sub-flow]]:::processCall
C --> D[Set Variable]:::contentModifier
D --> E[Transform Payload]:::mapping
E --> F[Set Response]:::contentModifier
F --> G((End))
</pre>
<h3 id="flow-6-add-standing-orders-flow">Flow 6: Add Standing Orders Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Add Standing Orders Flow
A((Start)) --> B[POST /InvestmentAccounts/accountId/Payments/Initiate]:::httpAdapter
B --> C[[add-standing-orders-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h3 id="flow-7-cancel-standing-orders-flow">Flow 7: Cancel Standing Orders Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Cancel Standing Orders Flow
A((Start)) --> B[PATCH /InvestmentAccounts/accountId/Payments/Update]:::httpAdapter
B --> C[[cancel-standing-orders-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h3 id="flow-8-retrieve-standing-orders-flow">Flow 8: Retrieve Standing Orders Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Retrieve Standing Orders Flow
A((Start)) --> B[GET /InvestmentAccounts/accountId/Payments/Retrieve]:::httpAdapter
B --> C[Log Query Parameters]:::contentModifier
C --> D[[retrieve-standing-orders-sub-flow]]:::processCall
D --> E[Set Variable]:::contentModifier
E --> F[Transform Payload]:::mapping
F --> G[Set Response]:::contentModifier
G --> H((End))
</pre>
<h3 id="flow-9-update-customer-profile-flow">Flow 9: Update Customer Profile Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Update Customer Profile Flow
A((Start)) --> B[PATCH /customers/customerId]:::httpAdapter
B --> C[[update-customers-profile-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h3 id="flow-10-acats-transaction-flow">Flow 10: ACATS Transaction Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% ACATS Transaction Flow
A((Start)) --> B[POST /InvestmentAccounts/accountId/Acats]:::httpAdapter
B --> C[[prepare-acats-response-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h3 id="flow-11-rmd-transaction-flow">Flow 11: RMD Transaction Flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% RMD Transaction Flow
A((Start)) --> B[POST /InvestmentAccounts/accountId/RMD]:::httpAdapter
B --> C[[prepare-rmd-response-sub-flow]]:::processCall
C --> D[Transform Payload]:::mapping
D --> E[Set Response]:::contentModifier
E --> F((End))
</pre>
<h2 id="configuration-details">Configuration Details</h2>
<h3 id="http-adapter-configuration">HTTP Adapter Configuration</h3>
<ul>
<li><strong>Endpoint</strong>: <code>/api/v1</code></li>
<li><strong>HTTPS</strong>: Enabled</li>
<li><strong>Authentication</strong>: Basic Authentication (configuration decision)</li>
<li><strong>CSRF Protection</strong>: Disabled</li>
<li><strong>Timeout</strong>: 30 seconds (default)</li>
</ul>
<h3 id="content-modifier-configuration">Content Modifier Configuration</h3>
<ul>
<li><strong>Variable Setting</strong>: Use Content Modifier to set variables like <code>investmentAccountDetails</code> and <code>paymentOrders</code></li>
<li><strong>Header Setting</strong>: Use Content Modifier to set HTTP headers</li>
<li><strong>Response Preparation</strong>: Use Content Modifier to prepare HTTP responses</li>
</ul>
<h3 id="message-mapping-configuration">Message Mapping Configuration</h3>
<ul>
<li><strong>Mapping Language</strong>: Groovy or XSLT (equivalent to DataWeave)</li>
<li><strong>Input Format</strong>: JSON</li>
<li><strong>Output Format</strong>: JSON</li>
<li><strong>Null Handling</strong>: Skip null values (equivalent to <code>skipNullOn="everywhere"</code>)</li>
</ul>
<h3 id="router-configuration">Router Configuration</h3>
<ul>
<li><strong>Routing Condition</strong>: Based on the request path and method</li>
<li><strong>Default Route</strong>: Error route for unmatched requests</li>
</ul>
<h3 id="exception-subprocess-configuration">Exception Subprocess Configuration</h3>
<ul>
<li><strong>Error Types</strong>: Map MuleSoft error types to SAP Integration Suite error types</li>
<li><strong>Error Handling</strong>: Use Content Modifier to prepare error responses</li>
<li><strong>Error Logging</strong>: Use Write Message to Log for error logging</li>
</ul>
<h1 id="configuration">Configuration</h1>
<h2 id="important-configuration-parameters">Important Configuration Parameters</h2>
<ul>
<li><strong>API Definition</strong>: Based on RAML definition <code>fsc-wealth-management-api.raml</code></li>
<li><strong>HTTP Listener Configuration</strong>: <code>fsc-wealth-management-api-httpListenerConfig</code></li>
<li><strong>API Configuration</strong>: <code>fsc-wealth-management-api-config</code></li>
<li><strong>Outbound Headers Map Name</strong>: <code>outboundHeaders</code></li>
<li><strong>HTTP Status Variable Name</strong>: <code>httpStatus</code></li>
</ul>
<h2 id="environment-variables">Environment Variables</h2>
<ul>
<li><strong>TLS Configuration</strong>:</li>
<li><code>keySecret</code>: <code>integration@keystore</code></li>
<li><code>keyStoreSecret</code>: <code>integration@keystore</code></li>
</ul>
<h2 id="dependencies-on-external-systems">Dependencies on External Systems</h2>
<p>No explicit external system dependencies are mentioned in the source documentation. The application appears to be self-contained, using mock data for responses.</p>
<h2 id="security-settings">Security Settings</h2>
<ul>
<li><strong>TLS</strong>: Configured with keystore secrets</li>
<li><strong>Authentication</strong>: Not explicitly defined in the source documentation (configuration decision)</li>
<li><strong>Authorization</strong>: Not explicitly defined in the source documentation (configuration decision)</li>
</ul>
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>