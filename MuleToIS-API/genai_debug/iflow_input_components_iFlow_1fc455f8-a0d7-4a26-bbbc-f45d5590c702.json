{
  "api_name": "Product API",
  "base_url": "/api/v1",
  "endpoints": [
    {
      "method": "GET",
      "path": "/products",
      "purpose": "Retrieve product details based on product identifier",
      "components": [
        {
          "type": "odata",
          "name": "Get_Product_Details",
          "id": "odata_get_product",
          "config": {
            "address": "https://refapp-espm-ui-cf.cfapps.eu10.hana.ondemand.com:443/espm-cloud-web/espm.svc",
            "resource_path": "Products",
            "operation": "Query(GET)",
            "query_options": "$filter=ProductId eq '${header.productIdentifier}'&$select=ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit"
          }
        },
        {
          "type": "enricher",
          "name": "Validate_Product_ID",
          "id": "enricher_validate_product",
          "config": {
            "content": "${property.odata.productIdentifiers}.split(',').filter(item => item === ${header.productIdentifier}).length > 0"
          }
        },
        {
          "type": "enricher",
          "name": "Format_Error_Response",
          "id": "enricher_error_response",
          "config": {
            "content": "{ \"status\": \"error\", \"message\": \"The product identifier ${header.productIdentifier} was not found.\", \"errorCode\": \"PRODUCT_NOT_FOUND\" }"
          }
        }
      ],
      "sequence": [
        "enricher_validate_product",
        "odata_get_product",
        "enricher_error_response"
      ],
      "transformations": [
        {
          "name": "ValidateProductIdentifier.groovy",
          "type": "groovy",
          "script": "def productIdentifiers = property.get('odata.productIdentifiers').split(',');\ndef requestedId = message.getHeaders().get('productIdentifier');\n\ndef isValid = productIdentifiers.find { it == requestedId } != null;\n\nproperty.put('isExistProduct', isValid);\nreturn message;"
        },
        {
          "name": "FormatErrorResponse.groovy",
          "type": "groovy",
          "script": "import groovy.json.JsonBuilder;\n\ndef requestedId = message.getHeaders().get('productIdentifier');\n\ndef errorResponse = [\n    status: \"error\",\n    message: \"The product identifier \" + requestedId + \" was not found.\",\n    errorCode: \"PRODUCT_NOT_FOUND\"\n];\n\ndef jsonBuilder = new JsonBuilder(errorResponse);\nmessage.setBody(jsonBuilder.toString());\nreturn message;"
        }
      ],
      "sequence_flows": [
        {
          "id": "SequenceFlow_Start",
          "source": "odata_get_product",
          "target": "enricher_validate_product",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_Start\" sourceRef=\"odata_get_product\" targetRef=\"enricher_validate_product\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_End",
          "source": "enricher_validate_product",
          "target": "enricher_error_response",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_End\" sourceRef=\"enricher_validate_product\" targetRef=\"enricher_error_response\" isImmediate=\"true\"/>"
        }
      ]
    }
  ]
}