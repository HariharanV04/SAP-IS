{
  "api_name": "SAP HANA Product Information API",
  "base_url": "/products",
  "endpoints": [
    {
      "method": "GET",
      "path": "/products",
      "purpose": "Retrieves detailed product information based on a product identifier",
      "components": [
        {
          "type": "enricher",
          "name": "Set_IsExistProduct_Variable",
          "id": "enricher_set_variable",
          "config": {
            "content": "${property.isProductValid}"
          }
        },
        {
          "type": "odata",
          "name": "Get_Product_Details",
          "id": "odata_get_product",
          "config": {
            "address": "${property.hana_odata_service_url}",
            "resource_path": "Products",
            "operation": "Query(GET)",
            "query_options": "$filter=ProductId eq '${request.queryParams.productIdentifier}'&$select=ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit"
          }
        },
        {
          "type": "enricher",
          "name": "Validate_Product_ID",
          "id": "enricher_validate_product",
          "config": {
            "content": "${property.productIdentifiers.contains(request.queryParams.productIdentifier)}"
          }
        },
        {
          "type": "groovy_script",
          "name": "Product_Validation_Script",
          "id": "script_validate_product",
          "config": {
            "script": "ValidateProductIdentifier.groovy"
          }
        },
        {
          "type": "enricher",
          "name": "Format_Error_Response",
          "id": "enricher_error_response",
          "config": {
            "content": "{ \"status\": \"error\", \"message\": \"The product identifier ${request.queryParams.productIdentifier} was not found.\", \"errorCode\": \"PRODUCT_NOT_FOUND\" }"
          }
        }
      ],
      "sequence": [
        "script_validate_product",
        "enricher_set_variable",
        "odata_get_product",
        "enricher_error_response"
      ],
      "transformations": [
        {
          "name": "ValidateProductIdentifier.groovy",
          "type": "groovy",
          "script": "import com.sap.gateway.ip.core.customdev.util.Message;\n\ndef Message processData(Message message) {\n    def query = message.getHeaders().get(\"CamelHttpQuery\");\n    def productIdentifier = \"\";\n    \n    // Extract productIdentifier from query parameters\n    if (query != null && query.contains(\"productIdentifier=\")) {\n        def params = query.split(\"&\");\n        for (param in params) {\n            if (param.startsWith(\"productIdentifier=\")) {\n                productIdentifier = param.substring(\"productIdentifier=\".length());\n                break;\n            }\n        }\n    }\n    \n    // Get configured valid product identifiers\n    def validProductIds = properties.get(\"odata.productIdentifiers\").split(\",\");\n    \n    // Check if the provided product identifier is valid\n    boolean isValid = false;\n    for (validId in validProductIds) {\n        if (validId.trim().equals(productIdentifier)) {\n            isValid = true;\n            break;\n        }\n    }\n    \n    // Set the validation result as a property\n    message.setProperty(\"isProductValid\", isValid);\n    \n    return message;\n}"
        }
      ],
      "sequence_flows": [
        {
          "id": "SequenceFlow_Start",
          "source": "enricher_set_variable",
          "target": "odata_get_product",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_Start\" sourceRef=\"enricher_set_variable\" targetRef=\"odata_get_product\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_1",
          "source": "odata_get_product",
          "target": "enricher_validate_product",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_1\" sourceRef=\"odata_get_product\" targetRef=\"enricher_validate_product\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_2",
          "source": "enricher_validate_product",
          "target": "script_validate_product",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_2\" sourceRef=\"enricher_validate_product\" targetRef=\"script_validate_product\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_End",
          "source": "script_validate_product",
          "target": "enricher_error_response",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_End\" sourceRef=\"script_validate_product\" targetRef=\"enricher_error_response\" isImmediate=\"true\"/>"
        }
      ]
    }
  ]
}