{
  "api_name": "Products API",
  "base_url": "/products",
  "endpoints": [
    {
      "method": "GET",
      "path": "/products",
      "purpose": "Retrieves product details based on a product identifier",
      "components": [
        {
          "type": "enricher",
          "name": "Prepare_OData_Query",
          "id": "enricher_prepare_odata_query",
          "config": {
            "content": "${property.set('filter', \"ProductId eq '\" + property.get('productIdentifier') + \"'\")}"
          }
        },
        {
          "type": "odata",
          "name": "Get_Product_Details",
          "id": "odata_get_product_details",
          "config": {
            "address": "https://sap-hana-service/odata/service",
            "resource_path": "Products",
            "operation": "Query(GET)",
            "query_options": "$filter=${property.filter}&$select=ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit"
          }
        },
        {
          "type": "enricher",
          "name": "Validate_Product_ID",
          "id": "enricher_validate_product_id",
          "config": {
            "content": "${property.set('productIdentifier', request.queryParams.productIdentifier)}"
          }
        },
        {
          "type": "groovy_script",
          "name": "Check_Product_Exists",
          "id": "script_check_product_exists",
          "config": {
            "script": "ValidateProductIdentifier.groovy"
          }
        },
        {
          "type": "enricher",
          "name": "Format_Response",
          "id": "enricher_format_response",
          "config": {
            "content": "${if(property.get('isExistProduct') == 'true') { body.copy(); } else { body.set('{\"status\": \"error\", \"message\": \"The product identifier ' + property.get('productIdentifier') + ' was not found.\", \"errorCode\": \"PRODUCT_NOT_FOUND\"}'); }}"
          }
        }
      ],
      "sequence": [
        "enricher_validate_product_id",
        "script_check_product_exists",
        "enricher_prepare_odata_query",
        "odata_get_product_details",
        "enricher_format_response"
      ],
      "transformations": [
        {
          "name": "ValidateProductIdentifier.groovy",
          "type": "groovy",
          "script": "def productIdentifiers = property.get(\"odata.productIdentifiers\").split(\",\")\ndef requestedId = property.get(\"productIdentifier\")\ndef isExistProduct = productIdentifiers.any { it == requestedId }\nproperty.set(\"isExistProduct\", isExistProduct.toString())\nreturn message"
        }
      ],
      "sequence_flows": [
        {
          "id": "SequenceFlow_Start",
          "source": "enricher_prepare_odata_query",
          "target": "odata_get_product_details",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_Start\" sourceRef=\"enricher_prepare_odata_query\" targetRef=\"odata_get_product_details\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_1",
          "source": "odata_get_product_details",
          "target": "enricher_validate_product_id",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_1\" sourceRef=\"odata_get_product_details\" targetRef=\"enricher_validate_product_id\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_2",
          "source": "enricher_validate_product_id",
          "target": "script_check_product_exists",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_2\" sourceRef=\"enricher_validate_product_id\" targetRef=\"script_check_product_exists\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_End",
          "source": "script_check_product_exists",
          "target": "enricher_format_response",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_End\" sourceRef=\"script_check_product_exists\" targetRef=\"enricher_format_response\" isImmediate=\"true\"/>"
        }
      ]
    }
  ]
}